(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[330],{792:function(e,r,t){Promise.resolve().then(t.bind(t,9042))},9042:function(e,r,t){"use strict";t.r(r),t.d(r,{default:function(){return R}});var a=t(7437),s=t(2265),i=t(4033),n=t(5251),l=t(2167),o=t(7815),c=t(1478),d=t(500),u=t(6141),m=t(4530),p=t(5750),x=t(3715),f=t(8291),g=t(8063);function h(e){let{proxyId:r,participantNumber:t,currentWaiting:i,maxParticipants:h,status:b,isGroupComplete:y,redirectUrl:j,groupName:v,category:N,treatmentTitle:w,participantTimerStart:S,participantGender:E}=e,[D,T]=(0,s.useState)(3),[_,R]=(0,s.useState)(!1),[C,k]=(0,s.useState)(600),[A,Z]=(0,s.useState)(!1);return console.log("WaitingRoom props:",{proxyId:r,participantNumber:t,currentWaiting:i,maxParticipants:h,status:b,isGroupComplete:y,redirectUrl:j,participantTimerStart:S,participantTimeLeft:C,participantTimerExpired:A}),(0,s.useEffect)(()=>{let e=null;if(S&&!y&&"expired"!==b){console.log("Starting participant timer - participantTimerStart:",S);let r=Math.max(0,600-Math.floor((Date.now()-S)/1e3));k(r),r>0?e=setInterval(()=>{let r=Math.floor((Date.now()-S)/1e3),t=Math.max(0,600-r);console.log("Participant timer update - elapsed:",r,"timeLeft:",t),k(t),t<=0&&(Z(!0),e&&clearInterval(e))},1e3):Z(!0)}return()=>{e&&clearInterval(e)}},[S,y,b]),(0,s.useEffect)(()=>{if(y&&"redirected"===b){R(!0);let e=setInterval(()=>{T(r=>r<=1?(clearInterval(e),j&&(window.location.href=j),0):r-1)},1e3);return()=>clearInterval(e)}},[y,b,j]),(0,a.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-primary-50 via-background to-accent-50 flex items-center justify-center p-4",children:(0,a.jsx)(n.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"w-full max-w-2xl",children:(0,a.jsxs)(o.Zb,{className:"shadow-2xl border-0 bg-white/95 backdrop-blur-sm relative",children:[S&&!y&&!(A||"expired"===b)&&(0,a.jsx)(n.E.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},className:"absolute top-4 right-4 z-10",children:(0,a.jsxs)("div",{className:"\n                px-3 py-2 rounded-lg shadow-md border font-mono text-sm font-bold\n                ".concat(C<=60?"bg-red-100 border-red-300 text-red-700":C<=180?"bg-amber-100 border-amber-300 text-amber-700":"bg-blue-100 border-blue-300 text-blue-700","\n              "),children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(u.Z,{className:"h-4 w-4 ".concat(C<=60?"animate-pulse":"")}),(0,a.jsx)("span",{children:"".concat(Math.floor(C/60),":").concat((C%60).toString().padStart(2,"0"))})]}),(0,a.jsx)("div",{className:"text-xs font-normal mt-1 opacity-75 text-center",children:"Your time left"})]})}),(0,a.jsxs)(o.Ol,{className:"text-center pb-6",children:[(0,a.jsx)(n.E.div,{initial:{scale:0},animate:{scale:1},transition:{delay:.2,type:"spring"},className:"mx-auto mb-4 flex h-16 w-16 items-center justify-center rounded-full ".concat(A||"expired"===b?"bg-gradient-to-r from-red-600 to-red-700":y?"bg-gradient-to-r from-green-600 to-green-700":"bg-gradient-to-r from-primary-600 to-accent-600"),children:A||"expired"===b?(0,a.jsx)(u.Z,{className:"h-8 w-8 text-white"}):y?(0,a.jsx)(m.Z,{className:"h-8 w-8 text-white"}):(0,a.jsx)(p.Z,{className:"h-8 w-8 text-white"})}),(0,a.jsx)(o.ll,{className:"text-2xl font-bold text-gray-900",children:A||"expired"===b?"Time Expired":y?"Group Complete!":"Experiment Waiting Room"}),(0,a.jsx)(o.SZ,{className:"text-gray-600 text-lg",children:(()=>{if(A||"expired"===b)return"Your waiting time has expired. You did not get matched with a group in time.";if(y)return"Your group is complete! Redirecting to experiment...";let e=3-(i%3||3);return"All Male"===N?1===e?"Waiting for 1 more male participant to form a group...":"Waiting for ".concat(e," more male participants to form a group..."):"All Female"===N?1===e?"Waiting for 1 more female participant to form a group...":"Waiting for ".concat(e," more female participants to form a group..."):"Mixed"===N?"Waiting for participants to form a mixed-gender group...":1===e?"Waiting for 1 more participant to form a group...":"Waiting for ".concat(e," more participants to form a group...")})()})]}),(0,a.jsxs)(o.aY,{className:"space-y-6",children:[(0,a.jsx)("div",{className:"flex items-center justify-center space-x-4",children:(0,a.jsxs)(c.C,{variant:"outline",className:"px-4 py-2 text-lg",children:["You are Participant #",t]})}),!(A||"expired"===b)&&(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"Waiting for Group Formation"}),(0,a.jsxs)("span",{className:"text-sm font-bold text-gray-900",children:[i%3||3," / 3 in current group"]})]}),(0,a.jsx)(d.E,{value:(i%3||3)/3*100,className:"h-3"}),(0,a.jsxs)("div",{className:"flex justify-between text-xs text-gray-500",children:[(0,a.jsx)("span",{children:"Groups form automatically when 3 participants are ready"}),(0,a.jsxs)("span",{children:[i," total waiting"]})]})]}),(0,a.jsx)("div",{className:"flex justify-center space-x-4",children:Array.from({length:3},(e,r)=>{let t=r<(i%3||3);return(0,a.jsx)(n.E.div,{initial:{scale:0},animate:{scale:1},transition:{delay:.1*r},className:"\n                      w-16 h-16 rounded-full border-2 flex items-center justify-center\n                      ".concat(t?"bg-green-100 border-green-500 text-green-700":"bg-gray-100 border-gray-300 text-gray-400","\n                    "),children:t?(0,a.jsx)(m.Z,{className:"h-6 w-6"}):(0,a.jsx)(p.Z,{className:"h-6 w-6"})},r)})}),(0,a.jsx)(l.M,{mode:"wait",children:A||"expired"===b?(0,a.jsx)(n.E.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"text-center space-y-4",children:(0,a.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-center space-x-2 text-red-700 mb-2",children:[(0,a.jsx)(u.Z,{className:"h-5 w-5"}),(0,a.jsx)("span",{className:"font-semibold",children:"Your Time Expired"})]}),(0,a.jsx)("p",{className:"text-red-600 text-sm mb-3",children:"Your 10-minute waiting period has ended. You were not matched with a group in time."}),(0,a.jsx)("div",{className:"mt-4 text-xs text-red-500",children:"You may close this page or contact the experiment administrator."})]})},"expired"):y?(0,a.jsx)(n.E.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"text-center space-y-4",children:(0,a.jsxs)("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-center space-x-2 text-green-700 mb-2",children:[(0,a.jsx)(m.Z,{className:"h-5 w-5"}),(0,a.jsx)("span",{className:"font-semibold",children:"Your group is complete!"})]}),_&&(0,a.jsxs)("div",{className:"flex items-center justify-center space-x-2 text-green-600",children:[(0,a.jsx)(f.Z,{className:"h-4 w-4"}),(0,a.jsxs)("span",{children:["Redirecting in ",D," seconds..."]})]})]})},"complete"):(0,a.jsx)(n.E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"text-center space-y-3",children:(0,a.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-center space-x-2 text-blue-700 mb-2",children:[(0,a.jsx)(x.Z,{className:"h-5 w-5 animate-spin"}),(0,a.jsx)("span",{className:"text-sm font-semibold",children:"Waiting for more participants..."})]}),(0,a.jsx)("p",{className:"text-xs text-blue-600",children:"Your group will form automatically when ready"})]})},"waiting")}),N&&"No Gender"!==N&&!(A||"expired"===b)&&(0,a.jsx)("div",{className:"bg-gradient-to-r from-purple-50 to-blue-50 border border-purple-200 rounded-lg p-4",children:(0,a.jsxs)("div",{className:"flex items-start gap-3",children:[(0,a.jsx)("div",{className:"p-2 rounded-lg bg-purple-100",children:(0,a.jsx)(p.Z,{className:"h-5 w-5 text-purple-600"})}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("h4",{className:"font-semibold text-purple-900 mb-1",children:["All Male"===N&&"All Male Room","All Female"===N&&"All Female Room","Mixed"===N&&"Mixed Gender Room"]}),(0,a.jsxs)("p",{className:"text-sm text-purple-800",children:["Groups of 3 ","All Male"===N?"male":"All Female"===N?"female":""," participants form automatically"]}),E&&(0,a.jsxs)("div",{className:"mt-2 inline-flex items-center gap-2 px-2 py-1 bg-white rounded-md border border-purple-200",children:[(0,a.jsx)("span",{className:"text-xs text-purple-700",children:"Your gender:"}),(0,a.jsx)("span",{className:"text-xs font-semibold text-purple-900",children:E})]})]})]})}),!(A||"expired"===b)&&(0,a.jsxs)("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4",children:[(0,a.jsxs)("h4",{className:"font-semibold text-gray-900 mb-3 flex items-center gap-2",children:[(0,a.jsx)("div",{className:"p-1 rounded bg-gray-200",children:(0,a.jsx)(g.Z,{className:"h-4 w-4 text-gray-700"})}),"Important Instructions"]}),(0,a.jsxs)("ul",{className:"text-sm text-gray-700 space-y-2",children:[(0,a.jsxs)("li",{className:"flex items-start gap-2",children:[(0,a.jsx)("span",{className:"text-primary-600 font-bold",children:"•"}),(0,a.jsxs)("span",{children:[(0,a.jsx)("strong",{children:"Keep this page open"})," - Do not close or refresh"]})]}),(0,a.jsxs)("li",{className:"flex items-start gap-2",children:[(0,a.jsx)("span",{className:"text-primary-600 font-bold",children:"•"}),(0,a.jsxs)("span",{children:[(0,a.jsx)("strong",{children:"You have 10 minutes"})," to be matched with a group"]})]}),(0,a.jsxs)("li",{className:"flex items-start gap-2",children:[(0,a.jsx)("span",{className:"text-primary-600 font-bold",children:"•"}),(0,a.jsxs)("span",{children:[(0,a.jsx)("strong",{children:"Groups of 3"})," form automatically as participants join"]})]}),(0,a.jsxs)("li",{className:"flex items-start gap-2",children:[(0,a.jsx)("span",{className:"text-primary-600 font-bold",children:"•"}),(0,a.jsxs)("span",{children:["You'll be ",(0,a.jsx)("strong",{children:"redirected automatically"})," when your group is ready"]})]})]})]})]})]})})})}var b=t(5754),y=t(7929),j=t(4631),v=t(2527),N=t(9806);let w=(0,t(5531).Z)("house",[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-6a2 2 0 0 1 2.582 0l7 6A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"r6nss1"}]]);var S=t(1396),E=t.n(S);function D(e){let{error:r,errorType:t,link:s,usage:i,participantNumber:n,joinedAt:l}=e,d=(()=>{switch(t){case"not_found":return{title:"Link Not Found",description:"The requested experiment link does not exist or has been deactivated.",icon:j.Z,variant:"destructive"};case"full":return{title:"Experiment Full",description:"This experiment group is already full. All ".concat((null==s?void 0:s.max_uses)||0," participants have joined."),icon:p.Z,variant:"default"};case"already_participated":return{title:"Already Participated",description:"You have already joined this experiment group.",icon:m.Z,variant:"default"};case"already_joined":return{title:"Already in Waiting Room",description:"You have already joined this waiting room. Please use your original tab/window.",icon:v.Z,variant:"default"};case"inactive":return{title:"Experiment Inactive",description:"This experiment is currently inactive. Please contact the administrator.",icon:N.Z,variant:"secondary"};default:return{title:"Error",description:r,icon:j.Z,variant:"destructive"}}})(),u=d.icon;return(0,a.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-error-50 via-background to-warning-50 flex items-center justify-center p-4",children:(0,a.jsx)("div",{className:"w-full max-w-lg",children:(0,a.jsxs)(o.Zb,{className:"border-0 shadow-2xl bg-white/95 backdrop-blur-sm",children:[(0,a.jsxs)(o.Ol,{className:"text-center space-y-4 pb-8",children:[(0,a.jsx)("div",{className:"mx-auto flex h-16 w-16 items-center justify-center rounded-full bg-gradient-to-r from-error-100 to-error-200",children:(0,a.jsx)(u,{className:"h-8 w-8 text-error-600"})}),s&&(0,a.jsxs)(c.C,{variant:"outline",className:"mx-auto px-4 py-2 border-primary-200 bg-primary-50 text-primary-700",children:[(0,a.jsx)(p.Z,{className:"mr-2 h-4 w-4"}),s.group_name||"Experiment Group"]}),(0,a.jsx)(o.ll,{className:"text-2xl font-bold text-gray-900",children:d.title}),(0,a.jsx)(o.SZ,{className:"text-base text-gray-600",children:d.description})]}),(0,a.jsxs)(o.aY,{className:"space-y-6",children:[i&&"already_participated"===t&&(0,a.jsxs)(y.bZ,{className:"border-primary-200 bg-primary-50",children:[(0,a.jsx)(v.Z,{className:"h-4 w-4 text-primary-600"}),(0,a.jsxs)(y.X,{className:"text-primary-800",children:[(0,a.jsxs)("div",{className:"font-semibold mb-1",children:["Participant #",i.participant_number]}),(0,a.jsxs)("div",{className:"text-sm text-primary-700/70",children:["Joined on: ",new Date(i.used_at).toLocaleString()]})]})]}),"already_joined"===t&&n&&(0,a.jsxs)(y.bZ,{className:"border-amber-200 bg-amber-50",children:[(0,a.jsx)(j.Z,{className:"h-4 w-4 text-amber-600"}),(0,a.jsxs)(y.X,{className:"text-amber-800",children:[(0,a.jsxs)("div",{className:"font-semibold mb-2",children:["You are Participant #",n]}),(0,a.jsxs)("div",{className:"text-sm text-amber-700 space-y-2",children:[l&&(0,a.jsxs)("p",{children:["Joined at: ",new Date(l).toLocaleString()]}),(0,a.jsx)("p",{className:"font-medium",children:"⚠️ Please return to your original tab/window to see your waiting room status."}),(0,a.jsx)("p",{children:"Opening multiple tabs can cause issues with your participation."})]})]})]}),"full"===t&&s&&(0,a.jsxs)(y.bZ,{className:"border-warning-200 bg-warning-50",children:[(0,a.jsx)(j.Z,{className:"h-4 w-4 text-warning-600"}),(0,a.jsx)(y.X,{className:"text-warning-800",children:"Please contact the administrator if you need access to this experiment."})]}),(0,a.jsx)(b.z,{asChild:!0,className:"w-full bg-gradient-to-r from-primary-600 to-primary-700 hover:from-primary-700 hover:to-primary-800",size:"lg",children:(0,a.jsxs)(E(),{href:"/",children:[(0,a.jsx)(w,{className:"mr-2 h-4 w-4"}),"Return Home"]})})]})]})})})}var T=t(9842);function _(e){let{groupName:r,category:t,prolificPid:i,onSubmit:l}=e,[d,u]=(0,s.useState)(""),[m,x]=(0,s.useState)(!1),h="All Male"===t?"male":"All Female"===t?"female":null;return(0,a.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-primary-50 via-background to-accent-50 flex items-center justify-center p-4",children:(0,a.jsx)(n.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"w-full max-w-md",children:(0,a.jsxs)(o.Zb,{className:"shadow-2xl border-0 bg-white/95 backdrop-blur-sm",children:[(0,a.jsxs)(o.Ol,{className:"text-center pb-6",children:[(0,a.jsx)(n.E.div,{initial:{scale:0},animate:{scale:1},transition:{delay:.2,type:"spring"},className:"mx-auto mb-4 flex h-16 w-16 items-center justify-center rounded-full bg-gradient-to-r from-primary-600 to-accent-600",children:(0,a.jsx)(p.Z,{className:"h-8 w-8 text-white"})}),r&&(0,a.jsx)(c.C,{variant:"outline",className:"mx-auto mb-4 px-4 py-2 border-primary-200 bg-primary-50 text-primary-700",children:r}),(0,a.jsx)(o.ll,{className:"text-2xl font-bold text-gray-900",children:"Welcome to the Experiment"}),(0,a.jsx)(o.SZ,{className:"text-gray-600 text-base",children:"Please provide your gender information to continue"})]}),(0,a.jsxs)(o.aY,{className:"space-y-6",children:[i&&(0,a.jsx)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:(0,a.jsxs)("p",{className:"text-sm text-blue-800",children:[(0,a.jsx)("strong",{children:"Prolific ID:"})," ",i]})}),t&&"No Gender"!==t&&(0,a.jsx)("div",{className:"bg-purple-50 border border-purple-200 rounded-lg p-4",children:(0,a.jsxs)("div",{className:"flex items-start gap-2",children:[(0,a.jsx)(g.Z,{className:"h-5 w-5 text-purple-600 mt-0.5 flex-shrink-0"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"font-semibold text-purple-900 mb-1",children:"Group Requirement"}),(0,a.jsxs)("p",{className:"text-sm text-purple-800",children:["All Male"===t&&"This experiment requires male participants only.","All Female"===t&&"This experiment requires female participants only.","Mixed"===t&&"This experiment requires a mixed-gender group."]})]})]})}),(0,a.jsxs)("form",{onSubmit:e=>{e.preventDefault(),d&&(x(!0),l(d))},className:"space-y-4",children:[(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)(T._,{className:"text-base font-semibold text-gray-900",children:["What is your gender? ",(0,a.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(n.E.button,{type:"button",whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>u("MALE"),disabled:"female"===h,className:"\n                      w-full p-4 rounded-lg border-2 text-left transition-all\n                      ".concat("MALE"===d?"border-primary-500 bg-primary-50 shadow-md":"border-gray-200 bg-white hover:border-gray-300","\n                      ").concat("female"===h?"opacity-50 cursor-not-allowed":"cursor-pointer","\n                    "),children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{className:"font-medium text-gray-900",children:"Male"}),"MALE"===d&&(0,a.jsx)("div",{className:"h-5 w-5 rounded-full bg-primary-500 flex items-center justify-center",children:(0,a.jsx)("div",{className:"h-2 w-2 rounded-full bg-white"})})]})}),(0,a.jsx)(n.E.button,{type:"button",whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>u("FEMALE"),disabled:"male"===h,className:"\n                      w-full p-4 rounded-lg border-2 text-left transition-all\n                      ".concat("FEMALE"===d?"border-primary-500 bg-primary-50 shadow-md":"border-gray-200 bg-white hover:border-gray-300","\n                      ").concat("male"===h?"opacity-50 cursor-not-allowed":"cursor-pointer","\n                    "),children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{className:"font-medium text-gray-900",children:"Female"}),"FEMALE"===d&&(0,a.jsx)("div",{className:"h-5 w-5 rounded-full bg-primary-500 flex items-center justify-center",children:(0,a.jsx)("div",{className:"h-2 w-2 rounded-full bg-white"})})]})}),(!h||"Mixed"===t)&&(0,a.jsx)(n.E.button,{type:"button",whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>u("OTHER"),className:"\n                        w-full p-4 rounded-lg border-2 text-left transition-all cursor-pointer\n                        ".concat("OTHER"===d?"border-primary-500 bg-primary-50 shadow-md":"border-gray-200 bg-white hover:border-gray-300","\n                      "),children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{className:"font-medium text-gray-900",children:"Other / Prefer not to say"}),"OTHER"===d&&(0,a.jsx)("div",{className:"h-5 w-5 rounded-full bg-primary-500 flex items-center justify-center",children:(0,a.jsx)("div",{className:"h-2 w-2 rounded-full bg-white"})})]})})]})]}),(0,a.jsx)(b.z,{type:"submit",disabled:!d||m,className:"w-full bg-gradient-to-r from-primary-600 to-accent-600 hover:from-primary-700 hover:to-accent-700 disabled:opacity-50 disabled:cursor-not-allowed",size:"lg",children:m?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Joining..."]}):(0,a.jsxs)(a.Fragment,{children:["Continue to Waiting Room",(0,a.jsx)(f.Z,{className:"ml-2 h-4 w-4"})]})})]}),(0,a.jsx)("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-3",children:(0,a.jsxs)("p",{className:"text-xs text-gray-600",children:[(0,a.jsx)("strong",{children:"Privacy:"})," Your gender information is used only for group formation and is linked to your Prolific ID for this experiment. This data is not shared with third parties."]})})]})]})})})}function R(){let e=(0,i.useParams)(),r=null==e?void 0:e.id,[t,l]=(0,s.useState)(null),[o,c]=(0,s.useState)(!0),[d,u]=(0,s.useState)(""),[m,p]=(0,s.useState)(null),[x,f]=(0,s.useState)(null),[g,b]=(0,s.useState)(!1),[y,j]=(0,s.useState)(null);(0,s.useEffect)(()=>{if(r){let e=new URLSearchParams(window.location.search),r=e.get("gender")||e.get("GENDER"),t=e.get("PROLIFIC_PID")||e.get("prolific_pid");console.log("\uD83D\uDD0D URL Parameters:",{gender:r,prolific_pid:t}),f(t);let a=function(){let e=document.createElement("canvas"),r=e.getContext("2d");r.textBaseline="top",r.font="14px Arial",r.fillText("Browser fingerprint",2,2);let t=[navigator.userAgent,navigator.language,screen.width+"x"+screen.height,new Date().getTimezoneOffset(),e.toDataURL()].join("|"),a=0;for(let e=0;e<t.length;e++)a=(a<<5)-a+t.charCodeAt(e),a&=a;return Math.abs(a).toString(16)}();u(a),r?(p(r),N(a,r,t)):v(a,t)}},[r]);let v=async(e,t)=>{try{let s=await fetch("/api/proxy/".concat(r,"/join"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({fingerprint:e,gender:null,prolific_pid:t})}),i=await s.json();if(s.ok||"gender"!==i.missingParameter){if(s.ok)l(i),c(!1);else{let e="inactive";if(404===s.status)e="not_found";else if(403===s.status){var a;"already_joined"===i.errorType?e="already_joined":(null===(a=i.error)||void 0===a?void 0:a.includes("full"))&&(e="full")}l({error:i.error,errorType:e,participantNumber:i.participantNumber,joinedAt:i.joinedAt}),c(!1)}}else j({groupName:i.groupName,category:i.category}),b(!0),c(!1)}catch(e){console.error("Error fetching link info:",e),l({error:"Network error. Please try again.",errorType:"inactive"}),c(!1)}},N=async(e,t,a)=>{try{let i=await fetch("/api/proxy/".concat(r,"/join"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({fingerprint:e,gender:t,prolific_pid:a})}),n=await i.json();if(console.log("Join response:",{status:i.status,result:n}),i.ok)l(n),("redirected"===n.status||n.isGroupComplete)&&n.redirectUrl&&(console.log("\uD83D\uDE80 GROUP FORMED! Redirecting immediately..."),console.log("Status:",n.status),console.log("Redirect URL:",n.redirectUrl),setTimeout(()=>{window.location.href=n.redirectUrl},1500));else{let e="inactive";if(404===i.status)e="not_found";else if(400===i.status)e="inactive";else if(403===i.status){var s;e="already_joined"===n.errorType?"already_joined":(null===(s=n.error)||void 0===s?void 0:s.includes("full"))||"full"===n.errorType?"full":"inactive"}console.error("❌ Join failed:",n.error),l({error:n.error||"Unable to join experiment",errorType:e,participantNumber:n.participantNumber,joinedAt:n.joinedAt})}}catch(e){console.error("Error joining waiting room:",e),l({error:"Network error. Please try again.",errorType:"inactive"})}finally{c(!1)}},w=async()=>{if(d||x)try{var e,a,s,i,n;let o=new URLSearchParams;x&&o.append("prolific_pid",x),d&&o.append("fingerprint",d);let c=await fetch("/api/proxy/".concat(r,"/status?").concat(o.toString())),u=await c.json();if(console.log("========== STATUS CHECK =========="),console.log("Prolific PID:",x),console.log("Full result:",JSON.stringify(u,null,2)),console.log("result.status:",u.status),console.log("result.userStatus:",u.userStatus),console.log("result.userStatus?.status:",null===(e=u.userStatus)||void 0===e?void 0:e.status),console.log("result.real_url:",u.real_url),console.log("=================================="),c.ok){let e=(null===(a=u.userStatus)||void 0===a?void 0:a.status)==="redirected",r={...t,currentWaiting:u.current_waiting,maxParticipants:u.max_uses,isGroupComplete:e,redirectUrl:u.real_url,groupName:u.group_name,category:u.category,treatmentTitle:u.treatment_title,participantTimerStart:u.participantTimerStart,participantTimerExpired:u.participantTimerExpired,participantTimeLeft:u.participantTimeLeft,status:u.participantTimerExpired?"expired":u.status||(null==t?void 0:t.status)||"waiting"};u.userStatus&&(r.status=u.userStatus.status,r.participantNumber=u.userStatus.participantNumber,r.groupSessionId=u.userStatus.groupSessionId,r.participantTimerStart=u.userStatus.participantTimerStart,r.participantTimeLeft=u.userStatus.participantTimeLeft,r.participantTimerExpired=u.userStatus.participantTimerExpired),console.log("\uD83D\uDCA1 isGroupComplete set to:",r.isGroupComplete,"(based on userStatus.status:",null===(s=u.userStatus)||void 0===s?void 0:s.status,")"),l(r);let o=(null===(i=u.userStatus)||void 0===i?void 0:i.status)==="redirected"||"redirected"===r.status||"redirected"===u.status;console.log("\uD83D\uDD0D Redirect check:"),console.log("  - result.userStatus?.status:",null===(n=u.userStatus)||void 0===n?void 0:n.status),console.log("  - newData.status:",r.status),console.log("  - result.status:",u.status),console.log("  - isRedirected:",o),console.log("  - result.real_url:",u.real_url),o&&u.real_url?(console.log("\uD83D\uDE80\uD83D\uDE80\uD83D\uDE80 REDIRECTING NOW! \uD83D\uDE80\uD83D\uDE80\uD83D\uDE80"),console.log("Redirect URL:",u.real_url),console.log("User Status:",u.userStatus),window.location.href=u.real_url):console.log("❌ NOT redirecting - isRedirected:",o,"real_url:",u.real_url)}}catch(e){console.error("Error checking status:",e)}};return((0,s.useEffect)(()=>{if(t&&"redirected"!==t.status&&!t.isGroupComplete){console.log("\uD83D\uDCE1 Starting polling... Current status:",t.status,"Prolific PID:",x);let e=setInterval(()=>{console.log("⏰ Polling tick - checking status for:",x),w()},2e3);return()=>{console.log("\uD83D\uDED1 Stopping poll for:",x),clearInterval(e)}}(null==t?void 0:t.status)==="redirected"&&console.log("✅ Status is redirected - stopping poll for:",x)},[null==t?void 0:t.status,null==t?void 0:t.isGroupComplete,d,x]),o)?(0,a.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-primary-50 via-background to-accent-50 flex items-center justify-center",children:(0,a.jsxs)(n.E.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"text-center",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600 mx-auto mb-4"}),(0,a.jsx)("p",{className:"text-gray-600",children:"Loading experiment..."})]})}):g?(0,a.jsx)(_,{groupName:null==y?void 0:y.groupName,category:null==y?void 0:y.category,prolificPid:x||void 0,onSubmit:e=>{p(e),b(!1),c(!0),N(d,e,x)}}):(null==t?void 0:t.error)?(0,a.jsx)(D,{error:t.error,errorType:t.errorType||"inactive",participantNumber:t.participantNumber,joinedAt:t.joinedAt}):(0,a.jsx)(h,{proxyId:r,participantNumber:(null==t?void 0:t.participantNumber)||0,currentWaiting:(null==t?void 0:t.currentWaiting)||0,maxParticipants:(null==t?void 0:t.maxParticipants)||3,status:(null==t?void 0:t.status)||"waiting",isGroupComplete:(null==t?void 0:t.isGroupComplete)||!1,redirectUrl:null==t?void 0:t.redirectUrl,groupName:null==t?void 0:t.groupName,category:null==t?void 0:t.category,treatmentTitle:null==t?void 0:t.treatmentTitle,participantTimerStart:null==t?void 0:t.participantTimerStart,participantGender:m||void 0})}},7929:function(e,r,t){"use strict";t.d(r,{X:function(){return c},bZ:function(){return o}});var a=t(7437),s=t(2265),i=t(6061),n=t(1657);let l=(0,i.j)("relative w-full rounded-lg border px-4 py-3 text-sm [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground [&>svg~*]:pl-7",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),o=s.forwardRef((e,r)=>{let{className:t,variant:s,...i}=e;return(0,a.jsx)("div",{ref:r,role:"alert",className:(0,n.cn)(l({variant:s}),t),...i})});o.displayName="Alert",s.forwardRef((e,r)=>{let{className:t,...s}=e;return(0,a.jsx)("h5",{ref:r,className:(0,n.cn)("mb-1 font-medium leading-none tracking-tight",t),...s})}).displayName="AlertTitle";let c=s.forwardRef((e,r)=>{let{className:t,...s}=e;return(0,a.jsx)("div",{ref:r,className:(0,n.cn)("text-sm [&_p]:leading-relaxed",t),...s})});c.displayName="AlertDescription"},1478:function(e,r,t){"use strict";t.d(r,{C:function(){return l}});var a=t(7437);t(2265);var s=t(6061),i=t(1657);let n=(0,s.j)("inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground shadow hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground shadow hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function l(e){let{className:r,variant:t,...s}=e;return(0,a.jsx)("div",{className:(0,i.cn)(n({variant:t}),r),...s})}},5754:function(e,r,t){"use strict";t.d(r,{z:function(){return c}});var a=t(7437),s=t(2265),i=t(7256),n=t(6061),l=t(1657);let o=(0,n.j)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),c=s.forwardRef((e,r)=>{let{className:t,variant:s,size:n,asChild:c=!1,...d}=e,u=c?i.g7:"button";return(0,a.jsx)(u,{className:(0,l.cn)(o({variant:s,size:n,className:t})),ref:r,...d})});c.displayName="Button"},7815:function(e,r,t){"use strict";t.d(r,{Ol:function(){return l},SZ:function(){return c},Zb:function(){return n},aY:function(){return d},ll:function(){return o}});var a=t(7437),s=t(2265),i=t(1657);let n=s.forwardRef((e,r)=>{let{className:t,...s}=e;return(0,a.jsx)("div",{ref:r,className:(0,i.cn)("rounded-xl border bg-card text-card-foreground shadow",t),...s})});n.displayName="Card";let l=s.forwardRef((e,r)=>{let{className:t,...s}=e;return(0,a.jsx)("div",{ref:r,className:(0,i.cn)("flex flex-col space-y-1.5 p-6",t),...s})});l.displayName="CardHeader";let o=s.forwardRef((e,r)=>{let{className:t,...s}=e;return(0,a.jsx)("div",{ref:r,className:(0,i.cn)("font-semibold leading-none tracking-tight",t),...s})});o.displayName="CardTitle";let c=s.forwardRef((e,r)=>{let{className:t,...s}=e;return(0,a.jsx)("div",{ref:r,className:(0,i.cn)("text-sm text-muted-foreground",t),...s})});c.displayName="CardDescription";let d=s.forwardRef((e,r)=>{let{className:t,...s}=e;return(0,a.jsx)("div",{ref:r,className:(0,i.cn)("p-6 pt-0",t),...s})});d.displayName="CardContent",s.forwardRef((e,r)=>{let{className:t,...s}=e;return(0,a.jsx)("div",{ref:r,className:(0,i.cn)("flex items-center p-6 pt-0",t),...s})}).displayName="CardFooter"},9842:function(e,r,t){"use strict";t.d(r,{_:function(){return c}});var a=t(7437),s=t(2265),i=t(6743),n=t(6061),l=t(1657);let o=(0,n.j)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),c=s.forwardRef((e,r)=>{let{className:t,...s}=e;return(0,a.jsx)(i.f,{ref:r,className:(0,l.cn)(o(),t),...s})});c.displayName=i.f.displayName},500:function(e,r,t){"use strict";t.d(r,{E:function(){return l}});var a=t(7437),s=t(2265),i=t(3177),n=t(1657);let l=s.forwardRef((e,r)=>{let{className:t,value:s,...l}=e;return(0,a.jsx)(i.fC,{ref:r,className:(0,n.cn)("relative h-2 w-full overflow-hidden rounded-full bg-primary/20",t),...l,children:(0,a.jsx)(i.z$,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:"translateX(-".concat(100-(s||0),"%)")}})})});l.displayName=i.fC.displayName},1657:function(e,r,t){"use strict";t.d(r,{cn:function(){return i}});var a=t(7042),s=t(4769);function i(){for(var e=arguments.length,r=Array(e),t=0;t<e;t++)r[t]=arguments[t];return(0,s.m6)((0,a.W)(r))}},4033:function(e,r,t){e.exports=t(5313)}},function(e){e.O(0,[609,790,398,283,971,938,744],function(){return e(e.s=792)}),_N_E=e.O()}]);