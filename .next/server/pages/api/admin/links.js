"use strict";(()=>{var e={};e.id=977,e.ids=[977],e.modules={8013:e=>{e.exports=require("mongodb")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6113:e=>{e.exports=require("crypto")},5015:(e,t,r)=>{r.r(t),r.d(t,{config:()=>f,default:()=>p,routeModule:()=>g});var n={};r.r(n),r.d(n,{default:()=>d});var i=r(1802),o=r(7153),a=r(6249);let{getAllProxyLinks:u,getWaitingParticipants:s}=r(5410),{requireAuth:l}=r(9800),{logActivity:c}=r(4090);async function d(e,t){if("GET"!==e.method)return t.status(405).json({error:"Method not allowed"});if(!l(e))return t.status(401).json({error:"Unauthorized - Admin login required"});try{let e=await u(),r=await Promise.all(e.map(async e=>{if(e.is_active){let t=await s(e.proxy_id);return{...e,waiting_count:t.length,waiting_participants:t.map(e=>({participant_number:e.participant_number,joined_at:e.joined_at}))}}return{...e,waiting_count:0,waiting_participants:[]}}));t.json(r)}catch(e){return console.error("❌ Get links error:",e),c("Get links error",{error:e.message}),t.status(500).json({error:"Database error"})}}let p=(0,a.l)(n,"default"),f=(0,a.l)(n,"config"),g=new i.PagesAPIRouteModule({definition:{kind:o.x.PAGES_API,page:"/api/admin/links",pathname:"/api/admin/links",bundlePath:"",filename:""},userland:n})},9800:(e,t,r)=>{let n=r(6113),i=process.env.SESSION_SECRET||"your-secret-key-change-this";function o(e){let t=Date.now(),r={...e,iat:t,exp:t+864e5},o=Buffer.from(JSON.stringify({alg:"HS256",typ:"JWT"})).toString("base64url"),a=Buffer.from(JSON.stringify(r)).toString("base64url"),u=n.createHmac("sha256",i).update(`${o}.${a}`).digest("base64url");return`${o}.${a}.${u}`}function a(e){try{if(!e)return null;let[t,r,o]=e.split("."),a=n.createHmac("sha256",i).update(`${t}.${r}`).digest("base64url");if(o!==a)return console.log("❌ JWT signature verification failed"),null;let u=JSON.parse(Buffer.from(r,"base64url").toString());if(u.exp<Date.now())return console.log("❌ JWT token expired"),null;return u}catch(e){return console.error("❌ JWT verification error:",e),null}}function u(e){let t=e.headers.cookie;if(t){let e=t.match(/auth-token=([^;]+)/);if(e)return e[1]}return null}e.exports={createToken:o,verifyToken:a,setAuthCookie:function(e,t){let r=o(t);e.setHeader("Set-Cookie",[`auth-token=${r}; HttpOnly; Path=/; Max-Age=86400; SameSite=Lax`])},clearAuthCookie:function(e){e.setHeader("Set-Cookie",["auth-token=; HttpOnly; Path=/; Max-Age=0; SameSite=Lax"])},getTokenFromRequest:u,requireAuth:function(e){return a(u(e))||(console.log("❌ Authentication required"),null)}}},4090:(e,t,r)=>{let n=r(6113);e.exports={generateProxyId:function(){return n.randomBytes(8).toString("hex")},isValidUrl:function(e){try{let t=new URL(e);return"http:"===t.protocol||"https:"===t.protocol}catch(e){return!1}},sanitizeInput:function(e){return e&&"string"==typeof e?e.trim().replace(/[<>]/g,""):""},logActivity:function(e,t={}){let r=new Date().toISOString();console.log(`[${r}] ${e}:`,t)},generateFingerprint:function(){return n.randomBytes(16).toString("hex")},getClientIP:function(e){return e.headers["x-forwarded-for"]||e.headers["x-real-ip"]||e.connection?.remoteAddress||"unknown"}}}};var t=require("../../../webpack-api-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[869],()=>r(5015));module.exports=n})();