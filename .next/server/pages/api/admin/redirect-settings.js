"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "pages/api/admin/redirect-settings";
exports.ids = ["pages/api/admin/redirect-settings"];
exports.modules = {

/***/ "mongodb":
/*!**************************!*\
  !*** external "mongodb" ***!
  \**************************/
/***/ ((module) => {

module.exports = require("mongodb");

/***/ }),

/***/ "next/dist/compiled/next-server/pages-api.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/pages-api.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/pages-api.runtime.dev.js");

/***/ }),

/***/ "crypto":
/*!*************************!*\
  !*** external "crypto" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("crypto");

/***/ }),

/***/ "(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fadmin%2Fredirect-settings&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Cadmin%5Credirect-settings.js&middlewareConfigBase64=e30%3D!":
/*!********************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fadmin%2Fredirect-settings&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Cadmin%5Credirect-settings.js&middlewareConfigBase64=e30%3D! ***!
  \********************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   config: () => (/* binding */ config),\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__),\n/* harmony export */   routeModule: () => (/* binding */ routeModule)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/pages-api/module.compiled */ \"(api)/./node_modules/next/dist/server/future/route-modules/pages-api/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(api)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/build/templates/helpers */ \"(api)/./node_modules/next/dist/build/templates/helpers.js\");\n/* harmony import */ var _pages_api_admin_redirect_settings_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./pages\\api\\admin\\redirect-settings.js */ \"(api)/./pages/api/admin/redirect-settings.js\");\n\n\n\n// Import the userland code.\n\n// Re-export the handler (should be the default export).\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_pages_api_admin_redirect_settings_js__WEBPACK_IMPORTED_MODULE_3__, \"default\"));\n// Re-export config.\nconst config = (0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_pages_api_admin_redirect_settings_js__WEBPACK_IMPORTED_MODULE_3__, \"config\");\n// Create and export the route module that will be consumed.\nconst routeModule = new next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__.PagesAPIRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.PAGES_API,\n        page: \"/api/admin/redirect-settings\",\n        pathname: \"/api/admin/redirect-settings\",\n        // The following aren't used in production.\n        bundlePath: \"\",\n        filename: \"\"\n    },\n    userland: _pages_api_admin_redirect_settings_js__WEBPACK_IMPORTED_MODULE_3__\n});\n\n//# sourceMappingURL=pages-api.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LXJvdXRlLWxvYWRlci9pbmRleC5qcz9raW5kPVBBR0VTX0FQSSZwYWdlPSUyRmFwaSUyRmFkbWluJTJGcmVkaXJlY3Qtc2V0dGluZ3MmcHJlZmVycmVkUmVnaW9uPSZhYnNvbHV0ZVBhZ2VQYXRoPS4lMkZwYWdlcyU1Q2FwaSU1Q2FkbWluJTVDcmVkaXJlY3Qtc2V0dGluZ3MuanMmbWlkZGxld2FyZUNvbmZpZ0Jhc2U2ND1lMzAlM0QhIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7O0FBQXNHO0FBQ3ZDO0FBQ0w7QUFDMUQ7QUFDc0U7QUFDdEU7QUFDQSxpRUFBZSx3RUFBSyxDQUFDLGtFQUFRLFlBQVksRUFBQztBQUMxQztBQUNPLGVBQWUsd0VBQUssQ0FBQyxrRUFBUTtBQUNwQztBQUNPLHdCQUF3QixnSEFBbUI7QUFDbEQ7QUFDQSxjQUFjLHlFQUFTO0FBQ3ZCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0wsWUFBWTtBQUNaLENBQUM7O0FBRUQiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9vdHJlZS1wcm94eS1zZXJ2ZXIvPzI1ODgiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgUGFnZXNBUElSb3V0ZU1vZHVsZSB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2Z1dHVyZS9yb3V0ZS1tb2R1bGVzL3BhZ2VzLWFwaS9tb2R1bGUuY29tcGlsZWRcIjtcbmltcG9ydCB7IFJvdXRlS2luZCB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2Z1dHVyZS9yb3V0ZS1raW5kXCI7XG5pbXBvcnQgeyBob2lzdCB9IGZyb20gXCJuZXh0L2Rpc3QvYnVpbGQvdGVtcGxhdGVzL2hlbHBlcnNcIjtcbi8vIEltcG9ydCB0aGUgdXNlcmxhbmQgY29kZS5cbmltcG9ydCAqIGFzIHVzZXJsYW5kIGZyb20gXCIuL3BhZ2VzXFxcXGFwaVxcXFxhZG1pblxcXFxyZWRpcmVjdC1zZXR0aW5ncy5qc1wiO1xuLy8gUmUtZXhwb3J0IHRoZSBoYW5kbGVyIChzaG91bGQgYmUgdGhlIGRlZmF1bHQgZXhwb3J0KS5cbmV4cG9ydCBkZWZhdWx0IGhvaXN0KHVzZXJsYW5kLCBcImRlZmF1bHRcIik7XG4vLyBSZS1leHBvcnQgY29uZmlnLlxuZXhwb3J0IGNvbnN0IGNvbmZpZyA9IGhvaXN0KHVzZXJsYW5kLCBcImNvbmZpZ1wiKTtcbi8vIENyZWF0ZSBhbmQgZXhwb3J0IHRoZSByb3V0ZSBtb2R1bGUgdGhhdCB3aWxsIGJlIGNvbnN1bWVkLlxuZXhwb3J0IGNvbnN0IHJvdXRlTW9kdWxlID0gbmV3IFBhZ2VzQVBJUm91dGVNb2R1bGUoe1xuICAgIGRlZmluaXRpb246IHtcbiAgICAgICAga2luZDogUm91dGVLaW5kLlBBR0VTX0FQSSxcbiAgICAgICAgcGFnZTogXCIvYXBpL2FkbWluL3JlZGlyZWN0LXNldHRpbmdzXCIsXG4gICAgICAgIHBhdGhuYW1lOiBcIi9hcGkvYWRtaW4vcmVkaXJlY3Qtc2V0dGluZ3NcIixcbiAgICAgICAgLy8gVGhlIGZvbGxvd2luZyBhcmVuJ3QgdXNlZCBpbiBwcm9kdWN0aW9uLlxuICAgICAgICBidW5kbGVQYXRoOiBcIlwiLFxuICAgICAgICBmaWxlbmFtZTogXCJcIlxuICAgIH0sXG4gICAgdXNlcmxhbmRcbn0pO1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1wYWdlcy1hcGkuanMubWFwIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fadmin%2Fredirect-settings&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Cadmin%5Credirect-settings.js&middlewareConfigBase64=e30%3D!\n");

/***/ }),

/***/ "(api)/./lib/database.js":
/*!*************************!*\
  !*** ./lib/database.js ***!
  \*************************/
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {

eval("// Pure Next.js database module (MongoDB only)\n\nconst { MongoClient, ServerApiVersion } = __webpack_require__(/*! mongodb */ \"mongodb\");\nlet client = null;\nlet db = null;\nlet isConnected = false;\nasync function connectToDatabase() {\n    if (isConnected && db) {\n        return db;\n    }\n    if (!process.env.DATABASE_URL) {\n        throw new Error(\"DATABASE_URL environment variable is required\");\n    }\n    try {\n        console.log(\"\\uD83D\\uDD0D Connecting to MongoDB...\");\n        client = new MongoClient(process.env.DATABASE_URL, {\n            serverApi: {\n                version: ServerApiVersion.v1,\n                strict: true,\n                deprecationErrors: true\n            }\n        });\n        await client.connect();\n        db = client.db(\"otree_proxy\");\n        isConnected = true;\n        // Test the connection\n        await client.db(\"admin\").command({\n            ping: 1\n        });\n        console.log(\"✅ MongoDB connected successfully\");\n        // Create indexes\n        await createIndexes();\n        return db;\n    } catch (error) {\n        console.error(\"❌ MongoDB connection failed:\", error);\n        throw error;\n    }\n}\nasync function createIndexes() {\n    try {\n        await db.collection(\"admins\").createIndex({\n            username: 1\n        }, {\n            unique: true\n        });\n        await db.collection(\"proxy_links\").createIndex({\n            proxy_id: 1\n        }, {\n            unique: true\n        });\n        await db.collection(\"link_usage\").createIndex({\n            proxy_id: 1,\n            user_fingerprint: 1\n        }, {\n            unique: true\n        });\n        console.log(\"✅ MongoDB indexes created\");\n    } catch (error) {\n        console.log(\"ℹ️ MongoDB indexes may already exist:\", error.message);\n    }\n}\n// Database operations\nasync function findAdmin(username) {\n    const database = await connectToDatabase();\n    return await database.collection(\"admins\").findOne({\n        username\n    });\n}\nasync function findAdminWithPassword(username, password) {\n    const database = await connectToDatabase();\n    return await database.collection(\"admins\").findOne({\n        username,\n        password\n    });\n}\nasync function getAllAdmins() {\n    const database = await connectToDatabase();\n    return await database.collection(\"admins\").find({}).toArray();\n}\nasync function createAdmin(username, password) {\n    const database = await connectToDatabase();\n    return await database.collection(\"admins\").insertOne({\n        username,\n        password,\n        created_at: new Date()\n    });\n}\nasync function getAllProxyLinks() {\n    const database = await connectToDatabase();\n    const links = await database.collection(\"proxy_links\").find({}).sort({\n        created_at: -1\n    }).toArray();\n    // Convert MongoDB format to frontend-compatible format\n    return links.map((link, index)=>({\n            id: link._id ? link._id.toString() : index + 1,\n            proxy_id: link.proxy_id,\n            real_url: link.real_url,\n            group_name: link.group_name,\n            category: link.category || null,\n            treatment_title: link.treatment_title || null,\n            max_uses: link.max_uses || 3,\n            current_uses: link.current_uses || 0,\n            is_active: link.is_active !== false,\n            status: link.status || \"active\",\n            completed_at: link.completed_at,\n            created_at: link.created_at instanceof Date ? link.created_at.toISOString() : link.created_at || new Date().toISOString(),\n            created_by: link.created_by || \"admin\"\n        }));\n}\nasync function getProxyLink(proxyId) {\n    const database = await connectToDatabase();\n    return await database.collection(\"proxy_links\").findOne({\n        proxy_id: proxyId\n    });\n}\nasync function getActiveProxyLink(proxyId) {\n    const database = await connectToDatabase();\n    return await database.collection(\"proxy_links\").findOne({\n        proxy_id: proxyId,\n        is_active: {\n            $ne: false\n        }\n    });\n}\nasync function createProxyLink(proxyId, realUrl, groupName, maxUses = 3, category = null, treatmentTitle = null) {\n    const database = await connectToDatabase();\n    return await database.collection(\"proxy_links\").insertOne({\n        proxy_id: proxyId,\n        real_url: realUrl,\n        group_name: groupName,\n        category: category,\n        treatment_title: treatmentTitle,\n        max_uses: maxUses,\n        current_uses: 0,\n        is_active: true,\n        created_at: new Date(),\n        created_by: \"admin\"\n    });\n}\nasync function updateProxyLinkStatus(proxyId, isActive) {\n    const database = await connectToDatabase();\n    return await database.collection(\"proxy_links\").updateOne({\n        proxy_id: proxyId\n    }, {\n        $set: {\n            is_active: isActive\n        }\n    });\n}\nasync function incrementProxyLinkUsage(proxyId) {\n    const database = await connectToDatabase();\n    return await database.collection(\"proxy_links\").updateOne({\n        proxy_id: proxyId\n    }, {\n        $inc: {\n            current_uses: 1\n        }\n    });\n}\nasync function resetProxyLinkUsage(proxyId) {\n    const database = await connectToDatabase();\n    await database.collection(\"proxy_links\").updateOne({\n        proxy_id: proxyId\n    }, {\n        $set: {\n            current_uses: 0\n        }\n    });\n    return await database.collection(\"link_usage\").deleteMany({\n        proxy_id: proxyId\n    });\n}\nasync function deleteProxyLink(proxyId) {\n    const database = await connectToDatabase();\n    await database.collection(\"link_usage\").deleteMany({\n        proxy_id: proxyId\n    });\n    return await database.collection(\"proxy_links\").deleteOne({\n        proxy_id: proxyId\n    });\n}\nasync function checkLinkUsage(proxyId, userFingerprint) {\n    const database = await connectToDatabase();\n    return await database.collection(\"link_usage\").findOne({\n        proxy_id: proxyId,\n        user_fingerprint: userFingerprint\n    });\n}\nasync function recordLinkUsage(proxyId, sessionId, userIp, userFingerprint, participantNumber) {\n    const database = await connectToDatabase();\n    return await database.collection(\"link_usage\").insertOne({\n        proxy_id: proxyId,\n        session_id: sessionId,\n        user_ip: userIp,\n        user_fingerprint: userFingerprint,\n        participant_number: participantNumber,\n        status: \"waiting\",\n        group_session_id: null,\n        joined_at: new Date(),\n        redirected_at: null,\n        used_at: new Date()\n    });\n}\n// New functions for group management\nasync function getWaitingParticipants(proxyId) {\n    const database = await connectToDatabase();\n    return await database.collection(\"link_usage\").find({\n        proxy_id: proxyId,\n        status: \"waiting\"\n    }).sort({\n        joined_at: 1\n    }).toArray();\n}\nasync function updateParticipantStatus(proxyId, userFingerprint, status, groupSessionId = null) {\n    const database = await connectToDatabase();\n    const updateData = {\n        status,\n        ...status === \"redirected\" && {\n            redirected_at: new Date()\n        },\n        ...groupSessionId && {\n            group_session_id: groupSessionId\n        }\n    };\n    return await database.collection(\"link_usage\").updateOne({\n        proxy_id: proxyId,\n        user_fingerprint: userFingerprint\n    }, {\n        $set: updateData\n    });\n}\nasync function createGroupSession(proxyId, participantFingerprints) {\n    const database = await connectToDatabase();\n    const groupSessionId = (__webpack_require__(/*! crypto */ \"crypto\").randomBytes)(16).toString(\"hex\");\n    // Update all participants with the group session ID\n    await database.collection(\"link_usage\").updateMany({\n        proxy_id: proxyId,\n        user_fingerprint: {\n            $in: participantFingerprints\n        },\n        status: \"waiting\"\n    }, {\n        $set: {\n            group_session_id: groupSessionId,\n            status: \"redirected\",\n            redirected_at: new Date()\n        }\n    });\n    // Mark the proxy link as used/completed when all participants are redirected\n    await database.collection(\"proxy_links\").updateOne({\n        proxy_id: proxyId\n    }, {\n        $set: {\n            status: \"used\",\n            completed_at: new Date(),\n            current_uses: participantFingerprints.length\n        }\n    });\n    return groupSessionId;\n}\nasync function getGroupStatus(proxyId) {\n    const database = await connectToDatabase();\n    const link = await getActiveProxyLink(proxyId);\n    if (!link) return null;\n    const waitingParticipants = await getWaitingParticipants(proxyId);\n    const allParticipants = await database.collection(\"link_usage\").find({\n        proxy_id: proxyId\n    }).toArray();\n    const redirectedParticipants = allParticipants.filter((p)=>p.status === \"redirected\");\n    const totalJoined = allParticipants.length;\n    const isGroupComplete = totalJoined >= link.max_uses;\n    const hasRedirectedGroup = redirectedParticipants.length > 0;\n    return {\n        proxy_id: proxyId,\n        group_name: link.group_name,\n        category: link.category,\n        treatment_title: link.treatment_title,\n        max_uses: link.max_uses,\n        current_waiting: waitingParticipants.length,\n        total_joined: totalJoined,\n        is_full: isGroupComplete,\n        has_redirected_group: hasRedirectedGroup,\n        waiting_participants: waitingParticipants.map((p)=>({\n                participant_number: p.participant_number,\n                joined_at: p.joined_at,\n                fingerprint: p.user_fingerprint.substring(0, 8) + \"...\" // Partial for privacy\n            })),\n        redirected_participants: redirectedParticipants.map((p)=>({\n                participant_number: p.participant_number,\n                redirected_at: p.redirected_at,\n                group_session_id: p.group_session_id\n            })),\n        real_url: link.real_url\n    };\n}\nasync function getProxyStats() {\n    const database = await connectToDatabase();\n    const links = await database.collection(\"proxy_links\").find({}).toArray();\n    const total = links.length;\n    const active = links.filter((link)=>link.is_active !== false && link.status !== \"used\").length;\n    const participants = links.reduce((sum, link)=>sum + (link.current_uses || 0), 0);\n    const full = links.filter((link)=>(link.current_uses || 0) >= (link.max_uses || 3)).length;\n    const used = links.filter((link)=>link.status === \"used\").length;\n    return {\n        total,\n        active,\n        participants,\n        full,\n        used\n    };\n}\nmodule.exports = {\n    connectToDatabase,\n    findAdmin,\n    findAdminWithPassword,\n    getAllAdmins,\n    createAdmin,\n    getAllProxyLinks,\n    getProxyLink,\n    getActiveProxyLink,\n    createProxyLink,\n    updateProxyLinkStatus,\n    incrementProxyLinkUsage,\n    resetProxyLinkUsage,\n    deleteProxyLink,\n    checkLinkUsage,\n    recordLinkUsage,\n    getProxyStats,\n    // New group management functions\n    getWaitingParticipants,\n    updateParticipantStatus,\n    createGroupSession,\n    getGroupStatus\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QVNYLEtBQUtZLE1BQU0sS0FBSyxRQUFRNkMsTUFBTTtJQUM5RixNQUFNcUIsZUFBZWpGLE1BQU1rRixNQUFNLENBQUMsQ0FBQ0MsS0FBS2hGLE9BQVNnRixNQUFPaEYsQ0FBQUEsS0FBS1UsWUFBWSxJQUFJLElBQUk7SUFDakYsTUFBTXVFLE9BQU9wRixNQUFNaUUsTUFBTSxDQUFDOUQsQ0FBQUEsT0FBUSxDQUFDQSxLQUFLVSxZQUFZLElBQUksTUFBT1YsQ0FBQUEsS0FBS1MsUUFBUSxJQUFJLElBQUlnRCxNQUFNO0lBQzFGLE1BQU15QixPQUFPckYsTUFBTWlFLE1BQU0sQ0FBQzlELENBQUFBLE9BQVFBLEtBQUtZLE1BQU0sS0FBSyxRQUFRNkMsTUFBTTtJQUVoRSxPQUFPO1FBQUVtQjtRQUFPQztRQUFRQztRQUFjRztRQUFNQztJQUFLO0FBQ25EO0FBRUFDLE9BQU9DLE9BQU8sR0FBRztJQUNmNUg7SUFDQXdCO0lBQ0FHO0lBQ0FFO0lBQ0FHO0lBQ0FJO0lBQ0FvQjtJQUNBRTtJQUNBRTtJQUNBSztJQUNBSTtJQUNBRTtJQUNBRTtJQUNBRTtJQUNBRTtJQUNBc0M7SUFDQSxpQ0FBaUM7SUFDakMzQjtJQUNBQztJQUNBRztJQUNBTTtBQUNGIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vb3RyZWUtcHJveHktc2VydmVyLy4vbGliL2RhdGFiYXNlLmpzP2VlYTUiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gUHVyZSBOZXh0LmpzIGRhdGFiYXNlIG1vZHVsZSAoTW9uZ29EQiBvbmx5KVxyXG5jb25zdCB7IE1vbmdvQ2xpZW50LCBTZXJ2ZXJBcGlWZXJzaW9uIH0gPSByZXF1aXJlKCdtb25nb2RiJyk7XHJcblxyXG5sZXQgY2xpZW50ID0gbnVsbDtcclxubGV0IGRiID0gbnVsbDtcclxubGV0IGlzQ29ubmVjdGVkID0gZmFsc2U7XHJcblxyXG5hc3luYyBmdW5jdGlvbiBjb25uZWN0VG9EYXRhYmFzZSgpIHtcclxuICBpZiAoaXNDb25uZWN0ZWQgJiYgZGIpIHtcclxuICAgIHJldHVybiBkYjtcclxuICB9XHJcblxyXG4gIGlmICghcHJvY2Vzcy5lbnYuREFUQUJBU0VfVVJMKSB7XHJcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ0RBVEFCQVNFX1VSTCBlbnZpcm9ubWVudCB2YXJpYWJsZSBpcyByZXF1aXJlZCcpO1xyXG4gIH1cclxuXHJcbiAgdHJ5IHtcclxuICAgIGNvbnNvbGUubG9nKCfwn5SNIENvbm5lY3RpbmcgdG8gTW9uZ29EQi4uLicpO1xyXG4gICAgXHJcbiAgICBjbGllbnQgPSBuZXcgTW9uZ29DbGllbnQocHJvY2Vzcy5lbnYuREFUQUJBU0VfVVJMLCB7XHJcbiAgICAgIHNlcnZlckFwaToge1xyXG4gICAgICAgIHZlcnNpb246IFNlcnZlckFwaVZlcnNpb24udjEsXHJcbiAgICAgICAgc3RyaWN0OiB0cnVlLFxyXG4gICAgICAgIGRlcHJlY2F0aW9uRXJyb3JzOiB0cnVlLFxyXG4gICAgICB9XHJcbiAgICB9KTtcclxuXHJcbiAgICBhd2FpdCBjbGllbnQuY29ubmVjdCgpO1xyXG4gICAgZGIgPSBjbGllbnQuZGIoJ290cmVlX3Byb3h5Jyk7XHJcbiAgICBpc0Nvbm5lY3RlZCA9IHRydWU7XHJcblxyXG4gICAgLy8gVGVzdCB0aGUgY29ubmVjdGlvblxyXG4gICAgYXdhaXQgY2xpZW50LmRiKFwiYWRtaW5cIikuY29tbWFuZCh7IHBpbmc6IDEgfSk7XHJcbiAgICBjb25zb2xlLmxvZygn4pyFIE1vbmdvREIgY29ubmVjdGVkIHN1Y2Nlc3NmdWxseScpO1xyXG5cclxuICAgIC8vIENyZWF0ZSBpbmRleGVzXHJcbiAgICBhd2FpdCBjcmVhdGVJbmRleGVzKCk7XHJcblxyXG4gICAgcmV0dXJuIGRiO1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKCfinYwgTW9uZ29EQiBjb25uZWN0aW9uIGZhaWxlZDonLCBlcnJvcik7XHJcbiAgICB0aHJvdyBlcnJvcjtcclxuICB9XHJcbn1cclxuXHJcbmFzeW5jIGZ1bmN0aW9uIGNyZWF0ZUluZGV4ZXMoKSB7XHJcbiAgdHJ5IHtcclxuICAgIGF3YWl0IGRiLmNvbGxlY3Rpb24oJ2FkbWlucycpLmNyZWF0ZUluZGV4KHsgdXNlcm5hbWU6IDEgfSwgeyB1bmlxdWU6IHRydWUgfSk7XHJcbiAgICBhd2FpdCBkYi5jb2xsZWN0aW9uKCdwcm94eV9saW5rcycpLmNyZWF0ZUluZGV4KHsgcHJveHlfaWQ6IDEgfSwgeyB1bmlxdWU6IHRydWUgfSk7XHJcbiAgICBhd2FpdCBkYi5jb2xsZWN0aW9uKCdsaW5rX3VzYWdlJykuY3JlYXRlSW5kZXgoeyBwcm94eV9pZDogMSwgdXNlcl9maW5nZXJwcmludDogMSB9LCB7IHVuaXF1ZTogdHJ1ZSB9KTtcclxuICAgIGNvbnNvbGUubG9nKCfinIUgTW9uZ29EQiBpbmRleGVzIGNyZWF0ZWQnKTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5sb2coJ+KEue+4jyBNb25nb0RCIGluZGV4ZXMgbWF5IGFscmVhZHkgZXhpc3Q6JywgZXJyb3IubWVzc2FnZSk7XHJcbiAgfVxyXG59XHJcblxyXG4vLyBEYXRhYmFzZSBvcGVyYXRpb25zXHJcbmFzeW5jIGZ1bmN0aW9uIGZpbmRBZG1pbih1c2VybmFtZSkge1xyXG4gIGNvbnN0IGRhdGFiYXNlID0gYXdhaXQgY29ubmVjdFRvRGF0YWJhc2UoKTtcclxuICByZXR1cm4gYXdhaXQgZGF0YWJhc2UuY29sbGVjdGlvbignYWRtaW5zJykuZmluZE9uZSh7IHVzZXJuYW1lIH0pO1xyXG59XHJcblxyXG5hc3luYyBmdW5jdGlvbiBmaW5kQWRtaW5XaXRoUGFzc3dvcmQodXNlcm5hbWUsIHBhc3N3b3JkKSB7XHJcbiAgY29uc3QgZGF0YWJhc2UgPSBhd2FpdCBjb25uZWN0VG9EYXRhYmFzZSgpO1xyXG4gIHJldHVybiBhd2FpdCBkYXRhYmFzZS5jb2xsZWN0aW9uKCdhZG1pbnMnKS5maW5kT25lKHsgdXNlcm5hbWUsIHBhc3N3b3JkIH0pO1xyXG59XHJcblxyXG5hc3luYyBmdW5jdGlvbiBnZXRBbGxBZG1pbnMoKSB7XHJcbiAgY29uc3QgZGF0YWJhc2UgPSBhd2FpdCBjb25uZWN0VG9EYXRhYmFzZSgpO1xyXG4gIHJldHVybiBhd2FpdCBkYXRhYmFzZS5jb2xsZWN0aW9uKCdhZG1pbnMnKS5maW5kKHt9KS50b0FycmF5KCk7XHJcbn1cclxuXHJcbmFzeW5jIGZ1bmN0aW9uIGNyZWF0ZUFkbWluKHVzZXJuYW1lLCBwYXNzd29yZCkge1xyXG4gIGNvbnN0IGRhdGFiYXNlID0gYXdhaXQgY29ubmVjdFRvRGF0YWJhc2UoKTtcclxuICByZXR1cm4gYXdhaXQgZGF0YWJhc2UuY29sbGVjdGlvbignYWRtaW5zJykuaW5zZXJ0T25lKHtcclxuICAgIHVzZXJuYW1lLFxyXG4gICAgcGFzc3dvcmQsXHJcbiAgICBjcmVhdGVkX2F0OiBuZXcgRGF0ZSgpXHJcbiAgfSk7XHJcbn1cclxuXHJcbmFzeW5jIGZ1bmN0aW9uIGdldEFsbFByb3h5TGlua3MoKSB7XHJcbiAgY29uc3QgZGF0YWJhc2UgPSBhd2FpdCBjb25uZWN0VG9EYXRhYmFzZSgpO1xyXG4gIGNvbnN0IGxpbmtzID0gYXdhaXQgZGF0YWJhc2UuY29sbGVjdGlvbigncHJveHlfbGlua3MnKS5maW5kKHt9KS5zb3J0KHsgY3JlYXRlZF9hdDogLTEgfSkudG9BcnJheSgpO1xyXG4gIFxyXG4gIC8vIENvbnZlcnQgTW9uZ29EQiBmb3JtYXQgdG8gZnJvbnRlbmQtY29tcGF0aWJsZSBmb3JtYXRcclxuICByZXR1cm4gbGlua3MubWFwKChsaW5rLCBpbmRleCkgPT4gKHtcclxuICAgIGlkOiBsaW5rLl9pZCA/IGxpbmsuX2lkLnRvU3RyaW5nKCkgOiBpbmRleCArIDEsXHJcbiAgICBwcm94eV9pZDogbGluay5wcm94eV9pZCxcclxuICAgIHJlYWxfdXJsOiBsaW5rLnJlYWxfdXJsLFxyXG4gICAgZ3JvdXBfbmFtZTogbGluay5ncm91cF9uYW1lLFxyXG4gICAgY2F0ZWdvcnk6IGxpbmsuY2F0ZWdvcnkgfHwgbnVsbCxcclxuICAgIHRyZWF0bWVudF90aXRsZTogbGluay50cmVhdG1lbnRfdGl0bGUgfHwgbnVsbCxcclxuICAgIG1heF91c2VzOiBsaW5rLm1heF91c2VzIHx8IDMsXHJcbiAgICBjdXJyZW50X3VzZXM6IGxpbmsuY3VycmVudF91c2VzIHx8IDAsXHJcbiAgICBpc19hY3RpdmU6IGxpbmsuaXNfYWN0aXZlICE9PSBmYWxzZSxcclxuICAgIHN0YXR1czogbGluay5zdGF0dXMgfHwgJ2FjdGl2ZScsIC8vIGFjdGl2ZSwgdXNlZCwgaW5hY3RpdmVcclxuICAgIGNvbXBsZXRlZF9hdDogbGluay5jb21wbGV0ZWRfYXQsXHJcbiAgICBjcmVhdGVkX2F0OiBsaW5rLmNyZWF0ZWRfYXQgaW5zdGFuY2VvZiBEYXRlID8gbGluay5jcmVhdGVkX2F0LnRvSVNPU3RyaW5nKCkgOiAobGluay5jcmVhdGVkX2F0IHx8IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSksXHJcbiAgICBjcmVhdGVkX2J5OiBsaW5rLmNyZWF0ZWRfYnkgfHwgJ2FkbWluJ1xyXG4gIH0pKTtcclxufVxyXG5cclxuYXN5bmMgZnVuY3Rpb24gZ2V0UHJveHlMaW5rKHByb3h5SWQpIHtcclxuICBjb25zdCBkYXRhYmFzZSA9IGF3YWl0IGNvbm5lY3RUb0RhdGFiYXNlKCk7XHJcbiAgcmV0dXJuIGF3YWl0IGRhdGFiYXNlLmNvbGxlY3Rpb24oJ3Byb3h5X2xpbmtzJykuZmluZE9uZSh7IHByb3h5X2lkOiBwcm94eUlkIH0pO1xyXG59XHJcblxyXG5hc3luYyBmdW5jdGlvbiBnZXRBY3RpdmVQcm94eUxpbmsocHJveHlJZCkge1xyXG4gIGNvbnN0IGRhdGFiYXNlID0gYXdhaXQgY29ubmVjdFRvRGF0YWJhc2UoKTtcclxuICByZXR1cm4gYXdhaXQgZGF0YWJhc2UuY29sbGVjdGlvbigncHJveHlfbGlua3MnKS5maW5kT25lKHsgXHJcbiAgICBwcm94eV9pZDogcHJveHlJZCwgXHJcbiAgICBpc19hY3RpdmU6IHsgJG5lOiBmYWxzZSB9XHJcbiAgfSk7XHJcbn1cclxuXHJcbmFzeW5jIGZ1bmN0aW9uIGNyZWF0ZVByb3h5TGluayhwcm94eUlkLCByZWFsVXJsLCBncm91cE5hbWUsIG1heFVzZXMgPSAzLCBjYXRlZ29yeSA9IG51bGwsIHRyZWF0bWVudFRpdGxlID0gbnVsbCkge1xyXG4gIGNvbnN0IGRhdGFiYXNlID0gYXdhaXQgY29ubmVjdFRvRGF0YWJhc2UoKTtcclxuICByZXR1cm4gYXdhaXQgZGF0YWJhc2UuY29sbGVjdGlvbigncHJveHlfbGlua3MnKS5pbnNlcnRPbmUoe1xyXG4gICAgcHJveHlfaWQ6IHByb3h5SWQsXHJcbiAgICByZWFsX3VybDogcmVhbFVybCxcclxuICAgIGdyb3VwX25hbWU6IGdyb3VwTmFtZSxcclxuICAgIGNhdGVnb3J5OiBjYXRlZ29yeSwgLy8gTm8gR2VuZGVyLCBBbGwgTWFsZSwgQWxsIEZlbWFsZSwgTWl4ZWRcclxuICAgIHRyZWF0bWVudF90aXRsZTogdHJlYXRtZW50VGl0bGUsIC8vIFRyZWF0bWVudCAxLTQgb3B0aW9uc1xyXG4gICAgbWF4X3VzZXM6IG1heFVzZXMsXHJcbiAgICBjdXJyZW50X3VzZXM6IDAsXHJcbiAgICBpc19hY3RpdmU6IHRydWUsXHJcbiAgICBjcmVhdGVkX2F0OiBuZXcgRGF0ZSgpLFxyXG4gICAgY3JlYXRlZF9ieTogJ2FkbWluJ1xyXG4gIH0pO1xyXG59XHJcblxyXG5hc3luYyBmdW5jdGlvbiB1cGRhdGVQcm94eUxpbmtTdGF0dXMocHJveHlJZCwgaXNBY3RpdmUpIHtcclxuICBjb25zdCBkYXRhYmFzZSA9IGF3YWl0IGNvbm5lY3RUb0RhdGFiYXNlKCk7XHJcbiAgcmV0dXJuIGF3YWl0IGRhdGFiYXNlLmNvbGxlY3Rpb24oJ3Byb3h5X2xpbmtzJykudXBkYXRlT25lKFxyXG4gICAgeyBwcm94eV9pZDogcHJveHlJZCB9LFxyXG4gICAgeyAkc2V0OiB7IGlzX2FjdGl2ZTogaXNBY3RpdmUgfSB9XHJcbiAgKTtcclxufVxyXG5cclxuYXN5bmMgZnVuY3Rpb24gaW5jcmVtZW50UHJveHlMaW5rVXNhZ2UocHJveHlJZCkge1xyXG4gIGNvbnN0IGRhdGFiYXNlID0gYXdhaXQgY29ubmVjdFRvRGF0YWJhc2UoKTtcclxuICByZXR1cm4gYXdhaXQgZGF0YWJhc2UuY29sbGVjdGlvbigncHJveHlfbGlua3MnKS51cGRhdGVPbmUoXHJcbiAgICB7IHByb3h5X2lkOiBwcm94eUlkIH0sXHJcbiAgICB7ICRpbmM6IHsgY3VycmVudF91c2VzOiAxIH0gfVxyXG4gICk7XHJcbn1cclxuXHJcbmFzeW5jIGZ1bmN0aW9uIHJlc2V0UHJveHlMaW5rVXNhZ2UocHJveHlJZCkge1xyXG4gIGNvbnN0IGRhdGFiYXNlID0gYXdhaXQgY29ubmVjdFRvRGF0YWJhc2UoKTtcclxuICBhd2FpdCBkYXRhYmFzZS5jb2xsZWN0aW9uKCdwcm94eV9saW5rcycpLnVwZGF0ZU9uZShcclxuICAgIHsgcHJveHlfaWQ6IHByb3h5SWQgfSxcclxuICAgIHsgJHNldDogeyBjdXJyZW50X3VzZXM6IDAgfSB9XHJcbiAgKTtcclxuICByZXR1cm4gYXdhaXQgZGF0YWJhc2UuY29sbGVjdGlvbignbGlua191c2FnZScpLmRlbGV0ZU1hbnkoeyBwcm94eV9pZDogcHJveHlJZCB9KTtcclxufVxyXG5cclxuYXN5bmMgZnVuY3Rpb24gZGVsZXRlUHJveHlMaW5rKHByb3h5SWQpIHtcclxuICBjb25zdCBkYXRhYmFzZSA9IGF3YWl0IGNvbm5lY3RUb0RhdGFiYXNlKCk7XHJcbiAgYXdhaXQgZGF0YWJhc2UuY29sbGVjdGlvbignbGlua191c2FnZScpLmRlbGV0ZU1hbnkoeyBwcm94eV9pZDogcHJveHlJZCB9KTtcclxuICByZXR1cm4gYXdhaXQgZGF0YWJhc2UuY29sbGVjdGlvbigncHJveHlfbGlua3MnKS5kZWxldGVPbmUoeyBwcm94eV9pZDogcHJveHlJZCB9KTtcclxufVxyXG5cclxuYXN5bmMgZnVuY3Rpb24gY2hlY2tMaW5rVXNhZ2UocHJveHlJZCwgdXNlckZpbmdlcnByaW50KSB7XHJcbiAgY29uc3QgZGF0YWJhc2UgPSBhd2FpdCBjb25uZWN0VG9EYXRhYmFzZSgpO1xyXG4gIHJldHVybiBhd2FpdCBkYXRhYmFzZS5jb2xsZWN0aW9uKCdsaW5rX3VzYWdlJykuZmluZE9uZSh7IFxyXG4gICAgcHJveHlfaWQ6IHByb3h5SWQsIFxyXG4gICAgdXNlcl9maW5nZXJwcmludDogdXNlckZpbmdlcnByaW50IFxyXG4gIH0pO1xyXG59XHJcblxyXG5hc3luYyBmdW5jdGlvbiByZWNvcmRMaW5rVXNhZ2UocHJveHlJZCwgc2Vzc2lvbklkLCB1c2VySXAsIHVzZXJGaW5nZXJwcmludCwgcGFydGljaXBhbnROdW1iZXIpIHtcclxuICBjb25zdCBkYXRhYmFzZSA9IGF3YWl0IGNvbm5lY3RUb0RhdGFiYXNlKCk7XHJcbiAgcmV0dXJuIGF3YWl0IGRhdGFiYXNlLmNvbGxlY3Rpb24oJ2xpbmtfdXNhZ2UnKS5pbnNlcnRPbmUoe1xyXG4gICAgcHJveHlfaWQ6IHByb3h5SWQsXHJcbiAgICBzZXNzaW9uX2lkOiBzZXNzaW9uSWQsXHJcbiAgICB1c2VyX2lwOiB1c2VySXAsXHJcbiAgICB1c2VyX2ZpbmdlcnByaW50OiB1c2VyRmluZ2VycHJpbnQsXHJcbiAgICBwYXJ0aWNpcGFudF9udW1iZXI6IHBhcnRpY2lwYW50TnVtYmVyLFxyXG4gICAgc3RhdHVzOiAnd2FpdGluZycsIC8vIHdhaXRpbmcsIHJlZGlyZWN0ZWRcclxuICAgIGdyb3VwX3Nlc3Npb25faWQ6IG51bGwsIC8vIFdpbGwgYmUgc2V0IHdoZW4gZ3JvdXAgaXMgZm9ybWVkXHJcbiAgICBqb2luZWRfYXQ6IG5ldyBEYXRlKCksXHJcbiAgICByZWRpcmVjdGVkX2F0OiBudWxsLFxyXG4gICAgdXNlZF9hdDogbmV3IERhdGUoKVxyXG4gIH0pO1xyXG59XHJcblxyXG4vLyBOZXcgZnVuY3Rpb25zIGZvciBncm91cCBtYW5hZ2VtZW50XHJcbmFzeW5jIGZ1bmN0aW9uIGdldFdhaXRpbmdQYXJ0aWNpcGFudHMocHJveHlJZCkge1xyXG4gIGNvbnN0IGRhdGFiYXNlID0gYXdhaXQgY29ubmVjdFRvRGF0YWJhc2UoKTtcclxuICByZXR1cm4gYXdhaXQgZGF0YWJhc2UuY29sbGVjdGlvbignbGlua191c2FnZScpLmZpbmQoeyBcclxuICAgIHByb3h5X2lkOiBwcm94eUlkLCBcclxuICAgIHN0YXR1czogJ3dhaXRpbmcnIFxyXG4gIH0pLnNvcnQoeyBqb2luZWRfYXQ6IDEgfSkudG9BcnJheSgpO1xyXG59XHJcblxyXG5hc3luYyBmdW5jdGlvbiB1cGRhdGVQYXJ0aWNpcGFudFN0YXR1cyhwcm94eUlkLCB1c2VyRmluZ2VycHJpbnQsIHN0YXR1cywgZ3JvdXBTZXNzaW9uSWQgPSBudWxsKSB7XHJcbiAgY29uc3QgZGF0YWJhc2UgPSBhd2FpdCBjb25uZWN0VG9EYXRhYmFzZSgpO1xyXG4gIGNvbnN0IHVwZGF0ZURhdGEgPSB7IFxyXG4gICAgc3RhdHVzLFxyXG4gICAgLi4uKHN0YXR1cyA9PT0gJ3JlZGlyZWN0ZWQnICYmIHsgcmVkaXJlY3RlZF9hdDogbmV3IERhdGUoKSB9KSxcclxuICAgIC4uLihncm91cFNlc3Npb25JZCAmJiB7IGdyb3VwX3Nlc3Npb25faWQ6IGdyb3VwU2Vzc2lvbklkIH0pXHJcbiAgfTtcclxuICBcclxuICByZXR1cm4gYXdhaXQgZGF0YWJhc2UuY29sbGVjdGlvbignbGlua191c2FnZScpLnVwZGF0ZU9uZShcclxuICAgIHsgcHJveHlfaWQ6IHByb3h5SWQsIHVzZXJfZmluZ2VycHJpbnQ6IHVzZXJGaW5nZXJwcmludCB9LFxyXG4gICAgeyAkc2V0OiB1cGRhdGVEYXRhIH1cclxuICApO1xyXG59XHJcblxyXG5hc3luYyBmdW5jdGlvbiBjcmVhdGVHcm91cFNlc3Npb24ocHJveHlJZCwgcGFydGljaXBhbnRGaW5nZXJwcmludHMpIHtcclxuICBjb25zdCBkYXRhYmFzZSA9IGF3YWl0IGNvbm5lY3RUb0RhdGFiYXNlKCk7XHJcbiAgY29uc3QgZ3JvdXBTZXNzaW9uSWQgPSByZXF1aXJlKCdjcnlwdG8nKS5yYW5kb21CeXRlcygxNikudG9TdHJpbmcoJ2hleCcpO1xyXG4gIFxyXG4gIC8vIFVwZGF0ZSBhbGwgcGFydGljaXBhbnRzIHdpdGggdGhlIGdyb3VwIHNlc3Npb24gSURcclxuICBhd2FpdCBkYXRhYmFzZS5jb2xsZWN0aW9uKCdsaW5rX3VzYWdlJykudXBkYXRlTWFueShcclxuICAgIHsgXHJcbiAgICAgIHByb3h5X2lkOiBwcm94eUlkLCBcclxuICAgICAgdXNlcl9maW5nZXJwcmludDogeyAkaW46IHBhcnRpY2lwYW50RmluZ2VycHJpbnRzIH0sXHJcbiAgICAgIHN0YXR1czogJ3dhaXRpbmcnXHJcbiAgICB9LFxyXG4gICAgeyBcclxuICAgICAgJHNldDogeyBcclxuICAgICAgICBncm91cF9zZXNzaW9uX2lkOiBncm91cFNlc3Npb25JZCxcclxuICAgICAgICBzdGF0dXM6ICdyZWRpcmVjdGVkJyxcclxuICAgICAgICByZWRpcmVjdGVkX2F0OiBuZXcgRGF0ZSgpXHJcbiAgICAgIH1cclxuICAgIH1cclxuICApO1xyXG4gIFxyXG4gIC8vIE1hcmsgdGhlIHByb3h5IGxpbmsgYXMgdXNlZC9jb21wbGV0ZWQgd2hlbiBhbGwgcGFydGljaXBhbnRzIGFyZSByZWRpcmVjdGVkXHJcbiAgYXdhaXQgZGF0YWJhc2UuY29sbGVjdGlvbigncHJveHlfbGlua3MnKS51cGRhdGVPbmUoXHJcbiAgICB7IHByb3h5X2lkOiBwcm94eUlkIH0sXHJcbiAgICB7IFxyXG4gICAgICAkc2V0OiB7IFxyXG4gICAgICAgIHN0YXR1czogJ3VzZWQnLFxyXG4gICAgICAgIGNvbXBsZXRlZF9hdDogbmV3IERhdGUoKSxcclxuICAgICAgICBjdXJyZW50X3VzZXM6IHBhcnRpY2lwYW50RmluZ2VycHJpbnRzLmxlbmd0aFxyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgKTtcclxuICBcclxuICByZXR1cm4gZ3JvdXBTZXNzaW9uSWQ7XHJcbn1cclxuXHJcbmFzeW5jIGZ1bmN0aW9uIGdldEdyb3VwU3RhdHVzKHByb3h5SWQpIHtcclxuICBjb25zdCBkYXRhYmFzZSA9IGF3YWl0IGNvbm5lY3RUb0RhdGFiYXNlKCk7XHJcbiAgY29uc3QgbGluayA9IGF3YWl0IGdldEFjdGl2ZVByb3h5TGluayhwcm94eUlkKTtcclxuICBpZiAoIWxpbmspIHJldHVybiBudWxsO1xyXG4gIFxyXG4gIGNvbnN0IHdhaXRpbmdQYXJ0aWNpcGFudHMgPSBhd2FpdCBnZXRXYWl0aW5nUGFydGljaXBhbnRzKHByb3h5SWQpO1xyXG4gIGNvbnN0IGFsbFBhcnRpY2lwYW50cyA9IGF3YWl0IGRhdGFiYXNlLmNvbGxlY3Rpb24oJ2xpbmtfdXNhZ2UnKS5maW5kKHsgcHJveHlfaWQ6IHByb3h5SWQgfSkudG9BcnJheSgpO1xyXG4gIGNvbnN0IHJlZGlyZWN0ZWRQYXJ0aWNpcGFudHMgPSBhbGxQYXJ0aWNpcGFudHMuZmlsdGVyKHAgPT4gcC5zdGF0dXMgPT09ICdyZWRpcmVjdGVkJyk7XHJcbiAgXHJcbiAgY29uc3QgdG90YWxKb2luZWQgPSBhbGxQYXJ0aWNpcGFudHMubGVuZ3RoO1xyXG4gIGNvbnN0IGlzR3JvdXBDb21wbGV0ZSA9IHRvdGFsSm9pbmVkID49IGxpbmsubWF4X3VzZXM7XHJcbiAgY29uc3QgaGFzUmVkaXJlY3RlZEdyb3VwID0gcmVkaXJlY3RlZFBhcnRpY2lwYW50cy5sZW5ndGggPiAwO1xyXG4gIFxyXG4gIHJldHVybiB7XHJcbiAgICBwcm94eV9pZDogcHJveHlJZCxcclxuICAgIGdyb3VwX25hbWU6IGxpbmsuZ3JvdXBfbmFtZSxcclxuICAgIGNhdGVnb3J5OiBsaW5rLmNhdGVnb3J5LFxyXG4gICAgdHJlYXRtZW50X3RpdGxlOiBsaW5rLnRyZWF0bWVudF90aXRsZSxcclxuICAgIG1heF91c2VzOiBsaW5rLm1heF91c2VzLFxyXG4gICAgY3VycmVudF93YWl0aW5nOiB3YWl0aW5nUGFydGljaXBhbnRzLmxlbmd0aCxcclxuICAgIHRvdGFsX2pvaW5lZDogdG90YWxKb2luZWQsXHJcbiAgICBpc19mdWxsOiBpc0dyb3VwQ29tcGxldGUsXHJcbiAgICBoYXNfcmVkaXJlY3RlZF9ncm91cDogaGFzUmVkaXJlY3RlZEdyb3VwLFxyXG4gICAgd2FpdGluZ19wYXJ0aWNpcGFudHM6IHdhaXRpbmdQYXJ0aWNpcGFudHMubWFwKHAgPT4gKHtcclxuICAgICAgcGFydGljaXBhbnRfbnVtYmVyOiBwLnBhcnRpY2lwYW50X251bWJlcixcclxuICAgICAgam9pbmVkX2F0OiBwLmpvaW5lZF9hdCxcclxuICAgICAgZmluZ2VycHJpbnQ6IHAudXNlcl9maW5nZXJwcmludC5zdWJzdHJpbmcoMCwgOCkgKyAnLi4uJyAvLyBQYXJ0aWFsIGZvciBwcml2YWN5XHJcbiAgICB9KSksXHJcbiAgICByZWRpcmVjdGVkX3BhcnRpY2lwYW50czogcmVkaXJlY3RlZFBhcnRpY2lwYW50cy5tYXAocCA9PiAoe1xyXG4gICAgICBwYXJ0aWNpcGFudF9udW1iZXI6IHAucGFydGljaXBhbnRfbnVtYmVyLFxyXG4gICAgICByZWRpcmVjdGVkX2F0OiBwLnJlZGlyZWN0ZWRfYXQsXHJcbiAgICAgIGdyb3VwX3Nlc3Npb25faWQ6IHAuZ3JvdXBfc2Vzc2lvbl9pZFxyXG4gICAgfSkpLFxyXG4gICAgcmVhbF91cmw6IGxpbmsucmVhbF91cmxcclxuICB9O1xyXG59XHJcblxyXG5hc3luYyBmdW5jdGlvbiBnZXRQcm94eVN0YXRzKCkge1xyXG4gIGNvbnN0IGRhdGFiYXNlID0gYXdhaXQgY29ubmVjdFRvRGF0YWJhc2UoKTtcclxuICBjb25zdCBsaW5rcyA9IGF3YWl0IGRhdGFiYXNlLmNvbGxlY3Rpb24oJ3Byb3h5X2xpbmtzJykuZmluZCh7fSkudG9BcnJheSgpO1xyXG4gIFxyXG4gIGNvbnN0IHRvdGFsID0gbGlua3MubGVuZ3RoO1xyXG4gIGNvbnN0IGFjdGl2ZSA9IGxpbmtzLmZpbHRlcihsaW5rID0+IGxpbmsuaXNfYWN0aXZlICE9PSBmYWxzZSAmJiBsaW5rLnN0YXR1cyAhPT0gJ3VzZWQnKS5sZW5ndGg7XHJcbiAgY29uc3QgcGFydGljaXBhbnRzID0gbGlua3MucmVkdWNlKChzdW0sIGxpbmspID0+IHN1bSArIChsaW5rLmN1cnJlbnRfdXNlcyB8fCAwKSwgMCk7XHJcbiAgY29uc3QgZnVsbCA9IGxpbmtzLmZpbHRlcihsaW5rID0+IChsaW5rLmN1cnJlbnRfdXNlcyB8fCAwKSA+PSAobGluay5tYXhfdXNlcyB8fCAzKSkubGVuZ3RoO1xyXG4gIGNvbnN0IHVzZWQgPSBsaW5rcy5maWx0ZXIobGluayA9PiBsaW5rLnN0YXR1cyA9PT0gJ3VzZWQnKS5sZW5ndGg7XHJcblxyXG4gIHJldHVybiB7IHRvdGFsLCBhY3RpdmUsIHBhcnRpY2lwYW50cywgZnVsbCwgdXNlZCB9O1xyXG59XHJcblxyXG5tb2R1bGUuZXhwb3J0cyA9IHtcclxuICBjb25uZWN0VG9EYXRhYmFzZSxcclxuICBmaW5kQWRtaW4sXHJcbiAgZmluZEFkbWluV2l0aFBhc3N3b3JkLFxyXG4gIGdldEFsbEFkbWlucyxcclxuICBjcmVhdGVBZG1pbixcclxuICBnZXRBbGxQcm94eUxpbmtzLFxyXG4gIGdldFByb3h5TGluayxcclxuICBnZXRBY3RpdmVQcm94eUxpbmssXHJcbiAgY3JlYXRlUHJveHlMaW5rLFxyXG4gIHVwZGF0ZVByb3h5TGlua1N0YXR1cyxcclxuICBpbmNyZW1lbnRQcm94eUxpbmtVc2FnZSxcclxuICByZXNldFByb3h5TGlua1VzYWdlLFxyXG4gIGRlbGV0ZVByb3h5TGluayxcclxuICBjaGVja0xpbmtVc2FnZSxcclxuICByZWNvcmRMaW5rVXNhZ2UsXHJcbiAgZ2V0UHJveHlTdGF0cyxcclxuICAvLyBOZXcgZ3JvdXAgbWFuYWdlbWVudCBmdW5jdGlvbnNcclxuICBnZXRXYWl0aW5nUGFydGljaXBhbnRzLFxyXG4gIHVwZGF0ZVBhcnRpY2lwYW50U3RhdHVzLFxyXG4gIGNyZWF0ZUdyb3VwU2Vzc2lvbixcclxuICBnZXRHcm91cFN0YXR1c1xyXG59OyJdLCJuYW1lcyI6WyJNb25nb0NsaWVudCIsIlNlcnZlckFwaVZlcnNpb24iLCJyZXF1aXJlIiwiY2xpZW50IiwiZGIiLCJpc0Nvbm5lY3RlZCIsImNvbm5lY3RUb0RhdGFiYXNlIiwicHJvY2VzcyIsImVudiIsIkRBVEFCQVNFX1VSTCIsIkVycm9yIiwiY29uc29sZSIsImxvZyIsInNlcnZlckFwaSIsInZlcnNpb24iLCJ2MSIsInN0cmljdCIsImRlcHJlY2F0aW9uRXJyb3JzIiwiY29ubmVjdCIsImNvbW1hbmQiLCJwaW5nIiwiY3JlYXRlSW5kZXhlcyIsImVycm9yIiwiY29sbGVjdGlvbiIsImNyZWF0ZUluZGV4IiwidXNlcm5hbWUiLCJ1bmlxdWUiLCJwcm94eV9pZCIsInVzZXJfZmluZ2VycHJpbnQiLCJtZXNzYWdlIiwiZmluZEFkbWluIiwiZGF0YWJhc2UiLCJmaW5kT25lIiwiZmluZEFkbWluV2l0aFBhc3N3b3JkIiwicGFzc3dvcmQiLCJnZXRBbGxBZG1pbnMiLCJmaW5kIiwidG9BcnJheSIsImNyZWF0ZUFkbWluIiwiaW5zZXJ0T25lIiwiY3JlYXRlZF9hdCIsIkRhdGUiLCJnZXRBbGxQcm94eUxpbmtzIiwibGlua3MiLCJzb3J0IiwibWFwIiwibGluayIsImluZGV4IiwiaWQiLCJfaWQiLCJ0b1N0cmluZyIsInJlYWxfdXJsIiwiZ3JvdXBfbmFtZSIsImNhdGVnb3J5IiwidHJlYXRtZW50X3RpdGxlIiwibWF4X3VzZXMiLCJjdXJyZW50X3VzZXMiLCJpc19hY3RpdmUiLCJzdGF0dXMiLCJjb21wbGV0ZWRfYXQiLCJ0b0lTT1N0cmluZyIsImNyZWF0ZWRfYnkiLCJnZXRQcm94eUxpbmsiLCJwcm94eUlkIiwiZ2V0QWN0aXZlUHJveHlMaW5rIiwiJG5lIiwiY3JlYXRlUHJveHlMaW5rIiwicmVhbFVybCIsImdyb3VwTmFtZSIsIm1heFVzZXMiLCJ0cmVhdG1lbnRUaXRsZSIsInVwZGF0ZVByb3h5TGlua1N0YXR1cyIsImlzQWN0aXZlIiwidXBkYXRlT25lIiwiJHNldCIsImluY3JlbWVudFByb3h5TGlua1VzYWdlIiwiJGluYyIsInJlc2V0UHJveHlMaW5rVXNhZ2UiLCJkZWxldGVNYW55IiwiZGVsZXRlUHJveHlMaW5rIiwiZGVsZXRlT25lIiwiY2hlY2tMaW5rVXNhZ2UiLCJ1c2VyRmluZ2VycHJpbnQiLCJyZWNvcmRMaW5rVXNhZ2UiLCJzZXNzaW9uSWQiLCJ1c2VySXAiLCJwYXJ0aWNpcGFudE51bWJlciIsInNlc3Npb25faWQiLCJ1c2VyX2lwIiwicGFydGljaXBhbnRfbnVtYmVyIiwiZ3JvdXBfc2Vzc2lvbl9pZCIsImpvaW5lZF9hdCIsInJlZGlyZWN0ZWRfYXQiLCJ1c2VkX2F0IiwiZ2V0V2FpdGluZ1BhcnRpY2lwYW50cyIsInVwZGF0ZVBhcnRpY2lwYW50U3RhdHVzIiwiZ3JvdXBTZXNzaW9uSWQiLCJ1cGRhdGVEYXRhIiwiY3JlYXRlR3JvdXBTZXNzaW9uIiwicGFydGljaXBhbnRGaW5nZXJwcmludHMiLCJyYW5kb21CeXRlcyIsInVwZGF0ZU1hbnkiLCIkaW4iLCJsZW5ndGgiLCJnZXRHcm91cFN0YXR1cyIsIndhaXRpbmdQYXJ0aWNpcGFudHMiLCJhbGxQYXJ0aWNpcGFudHMiLCJyZWRpcmVjdGVkUGFydGljaXBhbnRzIiwiZmlsdGVyIiwicCIsInRvdGFsSm9pbmVkIiwiaXNHcm91cENvbXBsZXRlIiwiaGFzUmVkaXJlY3RlZEdyb3VwIiwiY3VycmVudF93YWl0aW5nIiwidG90YWxfam9pbmVkIiwiaXNfZnVsbCIsImhhc19yZWRpcmVjdGVkX2dyb3VwIiwid2FpdGluZ19wYXJ0aWNpcGFudHMiLCJmaW5nZXJwcmludCIsInN1YnN0cmluZyIsInJlZGlyZWN0ZWRfcGFydGljaXBhbnRzIiwiZ2V0UHJveHlTdGF0cyIsInRvdGFsIiwiYWN0aXZlIiwicGFydGljaXBhbnRzIiwicmVkdWNlIiwic3VtIiwiZnVsbCIsInVzZWQiLCJtb2R1bGUiLCJleHBvcnRzIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/./lib/database.js\n");

/***/ }),

/***/ "(api)/./pages/api/admin/redirect-settings.js":
/*!**********************************************!*\
  !*** ./pages/api/admin/redirect-settings.js ***!
  \**********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (/* binding */ handler)\n/* harmony export */ });\n// API endpoint for managing gender-based redirect URLs\nconst { connectToDatabase } = __webpack_require__(/*! ../../../lib/database */ \"(api)/./lib/database.js\");\nasync function handler(req, res) {\n    try {\n        const db = await connectToDatabase();\n        if (req.method === \"GET\") {\n            // Get current redirect settings\n            const settings = await db.collection(\"redirect_settings\").findOne({\n                type: \"gender_redirect\"\n            });\n            res.status(200).json({\n                maleRedirectUrl: settings?.maleRedirectUrl || \"\",\n                femaleRedirectUrl: settings?.femaleRedirectUrl || \"\"\n            });\n        } else if (req.method === \"POST\") {\n            // Update redirect settings\n            const { maleRedirectUrl, femaleRedirectUrl } = req.body;\n            if (!maleRedirectUrl || !femaleRedirectUrl) {\n                return res.status(400).json({\n                    error: \"Both male and female redirect URLs are required\"\n                });\n            }\n            // Validate URLs\n            try {\n                new URL(maleRedirectUrl);\n                new URL(femaleRedirectUrl);\n            } catch (error) {\n                return res.status(400).json({\n                    error: \"Invalid URL format\"\n                });\n            }\n            await db.collection(\"redirect_settings\").updateOne({\n                type: \"gender_redirect\"\n            }, {\n                $set: {\n                    type: \"gender_redirect\",\n                    maleRedirectUrl,\n                    femaleRedirectUrl,\n                    updated_at: new Date(),\n                    updated_by: \"admin\"\n                }\n            }, {\n                upsert: true\n            });\n            res.status(200).json({\n                message: \"Redirect settings updated successfully\"\n            });\n        } else {\n            res.setHeader(\"Allow\", [\n                \"GET\",\n                \"POST\"\n            ]);\n            res.status(405).json({\n                error: \"Method not allowed\"\n            });\n        }\n    } catch (error) {\n        console.error(\"Redirect settings API error:\", error);\n        res.status(500).json({\n            error: \"Internal server error\"\n        });\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9wYWdlcy9hcGkvYWRtaW4vcmVkaXJlY3Qtc2V0dGluZ3MuanMiLCJtYXBwaW5ncyI6Ijs7OztBQUFBLHVEQUF1RDtBQUN2RCxNQUFNLEVBQUVBLGlCQUFpQixFQUFFLEdBQUdDLG1CQUFPQSxDQUFDO0FBRXZCLGVBQWVDLFFBQVFDLEdBQUcsRUFBRUMsR0FBRztJQUM1QyxJQUFJO1FBQ0YsTUFBTUMsS0FBSyxNQUFNTDtRQUVqQixJQUFJRyxJQUFJRyxNQUFNLEtBQUssT0FBTztZQUN4QixnQ0FBZ0M7WUFDaEMsTUFBTUMsV0FBVyxNQUFNRixHQUFHRyxVQUFVLENBQUMscUJBQXFCQyxPQUFPLENBQUM7Z0JBQUVDLE1BQU07WUFBa0I7WUFFNUZOLElBQUlPLE1BQU0sQ0FBQyxLQUFLQyxJQUFJLENBQUM7Z0JBQ25CQyxpQkFBaUJOLFVBQVVNLG1CQUFtQjtnQkFDOUNDLG1CQUFtQlAsVUFBVU8scUJBQXFCO1lBQ3BEO1FBRUYsT0FBTyxJQUFJWCxJQUFJRyxNQUFNLEtBQUssUUFBUTtZQUNoQywyQkFBMkI7WUFDM0IsTUFBTSxFQUFFTyxlQUFlLEVBQUVDLGlCQUFpQixFQUFFLEdBQUdYLElBQUlZLElBQUk7WUFFdkQsSUFBSSxDQUFDRixtQkFBbUIsQ0FBQ0MsbUJBQW1CO2dCQUMxQyxPQUFPVixJQUFJTyxNQUFNLENBQUMsS0FBS0MsSUFBSSxDQUFDO29CQUFFSSxPQUFPO2dCQUFrRDtZQUN6RjtZQUVBLGdCQUFnQjtZQUNoQixJQUFJO2dCQUNGLElBQUlDLElBQUlKO2dCQUNSLElBQUlJLElBQUlIO1lBQ1YsRUFBRSxPQUFPRSxPQUFPO2dCQUNkLE9BQU9aLElBQUlPLE1BQU0sQ0FBQyxLQUFLQyxJQUFJLENBQUM7b0JBQUVJLE9BQU87Z0JBQXFCO1lBQzVEO1lBRUEsTUFBTVgsR0FBR0csVUFBVSxDQUFDLHFCQUFxQlUsU0FBUyxDQUNoRDtnQkFBRVIsTUFBTTtZQUFrQixHQUMxQjtnQkFDRVMsTUFBTTtvQkFDSlQsTUFBTTtvQkFDTkc7b0JBQ0FDO29CQUNBTSxZQUFZLElBQUlDO29CQUNoQkMsWUFBWTtnQkFDZDtZQUNGLEdBQ0E7Z0JBQUVDLFFBQVE7WUFBSztZQUdqQm5CLElBQUlPLE1BQU0sQ0FBQyxLQUFLQyxJQUFJLENBQUM7Z0JBQUVZLFNBQVM7WUFBeUM7UUFFM0UsT0FBTztZQUNMcEIsSUFBSXFCLFNBQVMsQ0FBQyxTQUFTO2dCQUFDO2dCQUFPO2FBQU87WUFDdENyQixJQUFJTyxNQUFNLENBQUMsS0FBS0MsSUFBSSxDQUFDO2dCQUFFSSxPQUFPO1lBQXFCO1FBQ3JEO0lBQ0YsRUFBRSxPQUFPQSxPQUFPO1FBQ2RVLFFBQVFWLEtBQUssQ0FBQyxnQ0FBZ0NBO1FBQzlDWixJQUFJTyxNQUFNLENBQUMsS0FBS0MsSUFBSSxDQUFDO1lBQUVJLE9BQU87UUFBd0I7SUFDeEQ7QUFDRiIsInNvdXJjZXMiOlsid2VicGFjazovL290cmVlLXByb3h5LXNlcnZlci8uL3BhZ2VzL2FwaS9hZG1pbi9yZWRpcmVjdC1zZXR0aW5ncy5qcz84ZGRkIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIEFQSSBlbmRwb2ludCBmb3IgbWFuYWdpbmcgZ2VuZGVyLWJhc2VkIHJlZGlyZWN0IFVSTHNcclxuY29uc3QgeyBjb25uZWN0VG9EYXRhYmFzZSB9ID0gcmVxdWlyZSgnLi4vLi4vLi4vbGliL2RhdGFiYXNlJyk7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBhc3luYyBmdW5jdGlvbiBoYW5kbGVyKHJlcSwgcmVzKSB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IGRiID0gYXdhaXQgY29ubmVjdFRvRGF0YWJhc2UoKTtcclxuICAgIFxyXG4gICAgaWYgKHJlcS5tZXRob2QgPT09ICdHRVQnKSB7XHJcbiAgICAgIC8vIEdldCBjdXJyZW50IHJlZGlyZWN0IHNldHRpbmdzXHJcbiAgICAgIGNvbnN0IHNldHRpbmdzID0gYXdhaXQgZGIuY29sbGVjdGlvbigncmVkaXJlY3Rfc2V0dGluZ3MnKS5maW5kT25lKHsgdHlwZTogJ2dlbmRlcl9yZWRpcmVjdCcgfSk7XHJcbiAgICAgIFxyXG4gICAgICByZXMuc3RhdHVzKDIwMCkuanNvbih7XHJcbiAgICAgICAgbWFsZVJlZGlyZWN0VXJsOiBzZXR0aW5ncz8ubWFsZVJlZGlyZWN0VXJsIHx8ICcnLFxyXG4gICAgICAgIGZlbWFsZVJlZGlyZWN0VXJsOiBzZXR0aW5ncz8uZmVtYWxlUmVkaXJlY3RVcmwgfHwgJydcclxuICAgICAgfSk7XHJcbiAgICAgIFxyXG4gICAgfSBlbHNlIGlmIChyZXEubWV0aG9kID09PSAnUE9TVCcpIHtcclxuICAgICAgLy8gVXBkYXRlIHJlZGlyZWN0IHNldHRpbmdzXHJcbiAgICAgIGNvbnN0IHsgbWFsZVJlZGlyZWN0VXJsLCBmZW1hbGVSZWRpcmVjdFVybCB9ID0gcmVxLmJvZHk7XHJcbiAgICAgIFxyXG4gICAgICBpZiAoIW1hbGVSZWRpcmVjdFVybCB8fCAhZmVtYWxlUmVkaXJlY3RVcmwpIHtcclxuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oeyBlcnJvcjogJ0JvdGggbWFsZSBhbmQgZmVtYWxlIHJlZGlyZWN0IFVSTHMgYXJlIHJlcXVpcmVkJyB9KTtcclxuICAgICAgfVxyXG4gICAgICBcclxuICAgICAgLy8gVmFsaWRhdGUgVVJMc1xyXG4gICAgICB0cnkge1xyXG4gICAgICAgIG5ldyBVUkwobWFsZVJlZGlyZWN0VXJsKTtcclxuICAgICAgICBuZXcgVVJMKGZlbWFsZVJlZGlyZWN0VXJsKTtcclxuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oeyBlcnJvcjogJ0ludmFsaWQgVVJMIGZvcm1hdCcgfSk7XHJcbiAgICAgIH1cclxuICAgICAgXHJcbiAgICAgIGF3YWl0IGRiLmNvbGxlY3Rpb24oJ3JlZGlyZWN0X3NldHRpbmdzJykudXBkYXRlT25lKFxyXG4gICAgICAgIHsgdHlwZTogJ2dlbmRlcl9yZWRpcmVjdCcgfSxcclxuICAgICAgICB7IFxyXG4gICAgICAgICAgJHNldDogeyBcclxuICAgICAgICAgICAgdHlwZTogJ2dlbmRlcl9yZWRpcmVjdCcsXHJcbiAgICAgICAgICAgIG1hbGVSZWRpcmVjdFVybCxcclxuICAgICAgICAgICAgZmVtYWxlUmVkaXJlY3RVcmwsXHJcbiAgICAgICAgICAgIHVwZGF0ZWRfYXQ6IG5ldyBEYXRlKCksXHJcbiAgICAgICAgICAgIHVwZGF0ZWRfYnk6ICdhZG1pbidcclxuICAgICAgICAgIH1cclxuICAgICAgICB9LFxyXG4gICAgICAgIHsgdXBzZXJ0OiB0cnVlIH1cclxuICAgICAgKTtcclxuICAgICAgXHJcbiAgICAgIHJlcy5zdGF0dXMoMjAwKS5qc29uKHsgbWVzc2FnZTogJ1JlZGlyZWN0IHNldHRpbmdzIHVwZGF0ZWQgc3VjY2Vzc2Z1bGx5JyB9KTtcclxuICAgICAgXHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICByZXMuc2V0SGVhZGVyKCdBbGxvdycsIFsnR0VUJywgJ1BPU1QnXSk7XHJcbiAgICAgIHJlcy5zdGF0dXMoNDA1KS5qc29uKHsgZXJyb3I6ICdNZXRob2Qgbm90IGFsbG93ZWQnIH0pO1xyXG4gICAgfVxyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKCdSZWRpcmVjdCBzZXR0aW5ncyBBUEkgZXJyb3I6JywgZXJyb3IpO1xyXG4gICAgcmVzLnN0YXR1cyg1MDApLmpzb24oeyBlcnJvcjogJ0ludGVybmFsIHNlcnZlciBlcnJvcicgfSk7XHJcbiAgfVxyXG59Il0sIm5hbWVzIjpbImNvbm5lY3RUb0RhdGFiYXNlIiwicmVxdWlyZSIsImhhbmRsZXIiLCJyZXEiLCJyZXMiLCJkYiIsIm1ldGhvZCIsInNldHRpbmdzIiwiY29sbGVjdGlvbiIsImZpbmRPbmUiLCJ0eXBlIiwic3RhdHVzIiwianNvbiIsIm1hbGVSZWRpcmVjdFVybCIsImZlbWFsZVJlZGlyZWN0VXJsIiwiYm9keSIsImVycm9yIiwiVVJMIiwidXBkYXRlT25lIiwiJHNldCIsInVwZGF0ZWRfYXQiLCJEYXRlIiwidXBkYXRlZF9ieSIsInVwc2VydCIsIm1lc3NhZ2UiLCJzZXRIZWFkZXIiLCJjb25zb2xlIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/./pages/api/admin/redirect-settings.js\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../webpack-api-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next"], () => (__webpack_exec__("(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fadmin%2Fredirect-settings&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Cadmin%5Credirect-settings.js&middlewareConfigBase64=e30%3D!")));
module.exports = __webpack_exports__;

})();