"use strict";(()=>{var e={};e.id=943,e.ids=[943],e.modules={8013:e=>{e.exports=require("mongodb")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6113:e=>{e.exports=require("crypto")},6437:(e,t,r)=>{r.r(t),r.d(t,{config:()=>c,default:()=>p,routeModule:()=>_});var i={};r.r(i),r.d(i,{default:()=>l});var n=r(1802),a=r(7153),o=r(6249);let{getProxyLink:u,getAllParticipants:s}=r(5410),{requireAuth:d}=r(9800);async function l(e,t){if("GET"!==e.method)return t.status(405).json({error:"Method not allowed"});if(!d(e))return t.status(401).json({error:"Unauthorized - Admin login required"});let{proxyId:r}=e.query;if(!r)return t.status(400).json({error:"proxyId is required"});try{let e=await u(r);if(!e)return t.status(404).json({error:"Link not found"});let i=await s(r),n=i.filter(e=>"waiting"===e.status),a=i.filter(e=>"redirected"===e.status),o=i.filter(e=>"expired"===e.status),d={};a.forEach(e=>{let t=e.group_session_id||"unknown";d[t]||(d[t]=[]),d[t].push({participant_number:e.participant_number,prolific_pid:e.prolific_pid,gender:e.gender,joined_at:e.joined_at,redirected_at:e.redirected_at})});let l={link:{proxy_id:e.proxy_id,group_name:e.group_name,category:e.category,treatment_title:e.treatment_title,max_uses:e.max_uses,group_size:e.group_size||3,current_uses:e.current_uses||0,groups_formed:e.groups_formed||0,is_active:e.is_active,status:e.status,room_start_time:e.room_start_time,room_expired:e.room_expired,created_at:e.created_at},participants:{total:i.length,waiting:n.map(e=>({participant_number:e.participant_number,prolific_pid:e.prolific_pid,gender:e.gender,joined_at:e.joined_at,user_fingerprint:e.user_fingerprint?.substring(0,8)+"..."})),redirected:Object.entries(d).map(([e,t])=>({group_session_id:e,group_number:t[0]?.participant_number?Math.ceil(t[0].participant_number/3):0,members:t,redirected_at:t[0]?.redirected_at})),expired:o.map(e=>({participant_number:e.participant_number,prolific_pid:e.prolific_pid,gender:e.gender,joined_at:e.joined_at}))},statistics:{total_participants:i.length,waiting_count:n.length,redirected_count:a.length,expired_count:o.length,groups_formed:Object.keys(d).length,capacity_remaining:e.max_uses-i.length,capacity_percentage:Math.round(i.length/e.max_uses*100)}};t.json(l)}catch(e){return console.error("❌ Error fetching waiting room details:",e),t.status(500).json({error:"Internal server error"})}}let p=(0,o.l)(i,"default"),c=(0,o.l)(i,"config"),_=new n.PagesAPIRouteModule({definition:{kind:a.x.PAGES_API,page:"/api/admin/waiting-room-details",pathname:"/api/admin/waiting-room-details",bundlePath:"",filename:""},userland:i})},9800:(e,t,r)=>{let i=r(6113),n=process.env.SESSION_SECRET||"your-secret-key-change-this";function a(e){let t=Date.now(),r={...e,iat:t,exp:t+864e5},a=Buffer.from(JSON.stringify({alg:"HS256",typ:"JWT"})).toString("base64url"),o=Buffer.from(JSON.stringify(r)).toString("base64url"),u=i.createHmac("sha256",n).update(`${a}.${o}`).digest("base64url");return`${a}.${o}.${u}`}function o(e){try{if(!e)return null;let[t,r,a]=e.split("."),o=i.createHmac("sha256",n).update(`${t}.${r}`).digest("base64url");if(a!==o)return console.log("❌ JWT signature verification failed"),null;let u=JSON.parse(Buffer.from(r,"base64url").toString());if(u.exp<Date.now())return console.log("❌ JWT token expired"),null;return u}catch(e){return console.error("❌ JWT verification error:",e),null}}function u(e){let t=e.headers.cookie;if(t){let e=t.match(/auth-token=([^;]+)/);if(e)return e[1]}return null}e.exports={createToken:a,verifyToken:o,setAuthCookie:function(e,t){let r=a(t);e.setHeader("Set-Cookie",[`auth-token=${r}; HttpOnly; Path=/; Max-Age=86400; SameSite=Lax`])},clearAuthCookie:function(e){e.setHeader("Set-Cookie",["auth-token=; HttpOnly; Path=/; Max-Age=0; SameSite=Lax"])},getTokenFromRequest:u,requireAuth:function(e){return o(u(e))||(console.log("❌ Authentication required"),null)}}}};var t=require("../../../webpack-api-runtime.js");t.C(e);var r=e=>t(t.s=e),i=t.X(0,[869],()=>r(6437));module.exports=i})();