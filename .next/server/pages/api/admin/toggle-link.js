"use strict";(()=>{var e={};e.id=505,e.ids=[505],e.modules={8013:e=>{e.exports=require("mongodb")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},661:e=>{e.exports=require("sqlite3")},6113:e=>{e.exports=require("crypto")},1017:e=>{e.exports=require("path")},3557:(e,r,t)=>{t.r(r),t.d(r,{config:()=>g,default:()=>d,routeModule:()=>f});var o={};t.r(o),t.d(o,{default:()=>c});var i=t(1802),n=t(7153),a=t(6249);let{getDatabase:u}=t(5417),{verifyToken:s}=t(5352),{logActivity:l}=t(6427);async function c(e,r){if("POST"!==e.method)return r.status(405).json({error:"Method not allowed"});let o=s(e.cookies["auth-token"]);if(!o)return console.log("❌ Authentication required"),r.status(401).json({error:"Unauthorized - Admin login required"});let{proxyId:i,activate:n}=e.body;try{try{let{initDatabase:e}=t(5417);await e()}catch(e){console.log("ℹ️ Database already initialized or initialization not needed")}let e=u();await e.run("UPDATE proxy_links SET is_active = ? WHERE proxy_id = ?",[n?1:0,i]),l("Link toggled",{proxyId:i,activate:n,admin:o.username}),r.json({success:!0})}catch(e){return l("Toggle link error",{error:e.message,proxyId:i}),r.status(500).json({error:"Database error"})}}let d=(0,a.l)(o,"default"),g=(0,a.l)(o,"config"),f=new i.PagesAPIRouteModule({definition:{kind:n.x.PAGES_API,page:"/api/admin/toggle-link",pathname:"/api/admin/toggle-link",bundlePath:"",filename:""},userland:o})},5352:(e,r,t)=>{let o=t(6113),i=process.env.SESSION_SECRET||"your-secret-key-change-this";function n(e){let r=Date.now(),t={...e,iat:r,exp:r+864e5},n=Buffer.from(JSON.stringify({alg:"HS256",typ:"JWT"})).toString("base64url"),a=Buffer.from(JSON.stringify(t)).toString("base64url"),u=o.createHmac("sha256",i).update(`${n}.${a}`).digest("base64url");return`${n}.${a}.${u}`}function a(e){try{if(!e)return null;let[r,t,n]=e.split("."),a=o.createHmac("sha256",i).update(`${r}.${t}`).digest("base64url");if(n!==a)return console.log("❌ JWT signature verification failed"),null;let u=JSON.parse(Buffer.from(t,"base64url").toString());if(u.exp<Date.now())return console.log("❌ JWT token expired"),null;return console.log("✅ JWT token verified:",u),u}catch(e){return console.error("❌ JWT verification error:",e),null}}e.exports={createToken:n,verifyToken:a,setAuthCookie:function(e,r){console.log("\uD83D\uDD0D Setting auth cookie for user:",r.username);let t=n(r);e.cookie("auth-token",t,{httpOnly:!0,secure:!1,maxAge:864e5,sameSite:"lax"}),console.log("✅ Auth cookie set for user:",r.username)},clearAuthCookie:function(e){e.clearCookie("auth-token"),console.log("✅ Auth cookie cleared")},requireAuth:function(e,r,t){let o=a(e.cookies["auth-token"]);if(!o)return console.log("❌ Authentication required"),r.status(401).json({error:"Unauthorized - Admin login required"});e.user=o,e.isAuthenticated=!0,console.log("✅ User authenticated:",o.username),t()}}}};var r=require("../../../webpack-api-runtime.js");r.C(e);var t=e=>r(r.s=e),o=r.X(0,[188],()=>t(3557));module.exports=o})();