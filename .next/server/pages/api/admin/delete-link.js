"use strict";(()=>{var e={};e.id=164,e.ids=[164],e.modules={8013:e=>{e.exports=require("mongodb")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},661:e=>{e.exports=require("sqlite3")},6113:e=>{e.exports=require("crypto")},1017:e=>{e.exports=require("path")},9418:(e,r,t)=>{t.r(r),t.d(r,{config:()=>f,default:()=>d,routeModule:()=>g});var o={};t.r(o),t.d(o,{default:()=>c});var n=t(1802),i=t(7153),a=t(6249);let{getDatabase:u}=t(5417),{verifyToken:s}=t(5352),{logActivity:l}=t(6427);async function c(e,r){if("POST"!==e.method)return r.status(405).json({error:"Method not allowed"});let o=s(e.cookies["auth-token"]);if(!o)return console.log("❌ Authentication required"),r.status(401).json({error:"Unauthorized - Admin login required"});let{proxyId:n}=e.body;if(!n)return r.status(400).json({error:"Proxy ID is required"});try{try{let{initDatabase:e}=t(5417);await e()}catch(e){console.log("ℹ️ Database already initialized or initialization not needed")}let e=u();await e.run("DELETE FROM link_usage WHERE proxy_id = ?",[n]);let i=await e.run("DELETE FROM proxy_links WHERE proxy_id = ?",[n]);if(0===i.changes)return r.status(404).json({error:"Link not found"});l("Link deleted",{proxyId:n,admin:o.username}),r.json({success:!0})}catch(e){return l("Delete link error",{error:e.message,proxyId:n}),r.status(500).json({error:"Database error"})}}let d=(0,a.l)(o,"default"),f=(0,a.l)(o,"config"),g=new n.PagesAPIRouteModule({definition:{kind:i.x.PAGES_API,page:"/api/admin/delete-link",pathname:"/api/admin/delete-link",bundlePath:"",filename:""},userland:o})},5352:(e,r,t)=>{let o=t(6113),n=process.env.SESSION_SECRET||"your-secret-key-change-this";function i(e){let r=Date.now(),t={...e,iat:r,exp:r+864e5},i=Buffer.from(JSON.stringify({alg:"HS256",typ:"JWT"})).toString("base64url"),a=Buffer.from(JSON.stringify(t)).toString("base64url"),u=o.createHmac("sha256",n).update(`${i}.${a}`).digest("base64url");return`${i}.${a}.${u}`}function a(e){try{if(!e)return null;let[r,t,i]=e.split("."),a=o.createHmac("sha256",n).update(`${r}.${t}`).digest("base64url");if(i!==a)return console.log("❌ JWT signature verification failed"),null;let u=JSON.parse(Buffer.from(t,"base64url").toString());if(u.exp<Date.now())return console.log("❌ JWT token expired"),null;return console.log("✅ JWT token verified:",u),u}catch(e){return console.error("❌ JWT verification error:",e),null}}e.exports={createToken:i,verifyToken:a,setAuthCookie:function(e,r){console.log("\uD83D\uDD0D Setting auth cookie for user:",r.username);let t=i(r);e.cookie("auth-token",t,{httpOnly:!0,secure:!1,maxAge:864e5,sameSite:"lax"}),console.log("✅ Auth cookie set for user:",r.username)},clearAuthCookie:function(e){e.clearCookie("auth-token"),console.log("✅ Auth cookie cleared")},requireAuth:function(e,r,t){let o=a(e.cookies["auth-token"]);if(!o)return console.log("❌ Authentication required"),r.status(401).json({error:"Unauthorized - Admin login required"});e.user=o,e.isAuthenticated=!0,console.log("✅ User authenticated:",o.username),t()}}}};var r=require("../../../webpack-api-runtime.js");r.C(e);var t=e=>r(r.s=e),o=r.X(0,[188],()=>t(9418));module.exports=o})();