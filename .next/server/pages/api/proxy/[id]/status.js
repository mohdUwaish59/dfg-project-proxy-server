"use strict";(()=>{var t={};t.id=267,t.ids=[267],t.modules={8013:t=>{t.exports=require("mongodb")},145:t=>{t.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6113:t=>{t.exports=require("crypto")},4658:(t,e,r)=>{r.r(e),r.d(e,{config:()=>g,default:()=>c,routeModule:()=>f});var i={};r.r(i),r.d(i,{default:()=>d});var n=r(1802),o=r(7153),a=r(6249);let{getGroupStatus:s,checkLinkUsage:u,checkParticipantExpiration:l}=r(5410),{logActivity:p}=r(4090);async function d(t,e){if("GET"!==t.method)return e.status(405).json({error:"Method not allowed"});let{id:r}=t.query,{fingerprint:i,prolific_pid:n}=t.query,o=n||i;try{let t=await s(r);if(!t)return e.status(404).json({error:"Link not found or inactive"});let i=null,n=null;if(o){let e=await u(r,o);e&&(n=await l(r,o),i={status:e.status,participantNumber:e.participant_number,groupSessionId:e.group_session_id,joinedAt:e.joined_at,redirectedAt:e.redirected_at,participantTimerStart:n.timerStart,participantTimeLeft:n.timeLeft,participantTimerExpired:n.expired},t.has_redirected_group&&"waiting"===e.status&&(console.log("Warning: User still waiting but group has redirected participants"),console.log("User identifier:",o.substring(0,15)+"..."),console.log("User status:",e.status),console.log("Group status:",t)))}let a=null;if(o){let t=await u(r,o);t&&t.gender&&(a=t.gender)}let p={...t,userStatus:i,participantGender:a,participantTimerStart:n?.timerStart||null,participantTimeLeft:n?.timeLeft||600,participantTimerExpired:n?.expired||!1,status:n?.expired?"expired":i?.status||"waiting",timestamp:new Date().toISOString()};return console.log("\uD83D\uDCE4 STATUS API RESPONSE for",o?.substring(0,15)+"..."),console.log("  - userStatus?.status:",i?.status),console.log("  - responseData.status:",p.status),console.log("  - real_url:",t.real_url),e.json(p)}catch(t){return console.error("âŒ Get group status error:",t),p("Get group status error",{error:t.message,proxyId:r}),e.status(500).json({error:"Internal server error"})}}let c=(0,a.l)(i,"default"),g=(0,a.l)(i,"config"),f=new n.PagesAPIRouteModule({definition:{kind:o.x.PAGES_API,page:"/api/proxy/[id]/status",pathname:"/api/proxy/[id]/status",bundlePath:"",filename:""},userland:i})},4090:(t,e,r)=>{let i=r(6113);t.exports={generateProxyId:function(){return i.randomBytes(8).toString("hex")},isValidUrl:function(t){try{let e=new URL(t);return"http:"===e.protocol||"https:"===e.protocol}catch(t){return!1}},sanitizeInput:function(t){return t&&"string"==typeof t?t.trim().replace(/[<>]/g,""):""},logActivity:function(t,e={}){let r=new Date().toISOString();console.log(`[${r}] ${t}:`,e)},generateFingerprint:function(){return i.randomBytes(16).toString("hex")},getClientIP:function(t){return t.headers["x-forwarded-for"]||t.headers["x-real-ip"]||t.connection?.remoteAddress||"unknown"}}}};var e=require("../../../../webpack-api-runtime.js");e.C(t);var r=t=>e(e.s=t),i=e.X(0,[869],()=>r(4658));module.exports=i})();