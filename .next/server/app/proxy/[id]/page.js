(()=>{var e={};e.id=330,e.ids=[330],e.modules={7849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},5403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},4749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},5528:e=>{"use strict";e.exports=require("next/dist\\client\\components\\action-async-storage.external.js")},1877:e=>{"use strict";e.exports=require("next/dist\\client\\components\\request-async-storage.external.js")},5319:e=>{"use strict";e.exports=require("next/dist\\client\\components\\static-generation-async-storage.external.js")},5249:(e,t,r)=>{"use strict";r.r(t),r.d(t,{GlobalError:()=>l.a,__next_app__:()=>m,originalPathname:()=>p,pages:()=>d,routeModule:()=>u,tree:()=>c});var a=r(482),s=r(9108),i=r(2563),l=r.n(i),n=r(8300),o={};for(let e in n)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>n[e]);r.d(t,o);let c=["",{children:["proxy",{children:["[id]",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,9499)),"C:\\Users\\Mohd Uwaish\\Desktop\\MS\\DFG\\project\\DFG\\DFG_2025_Latest_work\\proxy-nov\\dfg-project-proxy-server\\app\\proxy\\[id]\\page.tsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(r.bind(r,7948)),"C:\\Users\\Mohd Uwaish\\Desktop\\MS\\DFG\\project\\DFG\\DFG_2025_Latest_work\\proxy-nov\\dfg-project-proxy-server\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,9361,23)),"next/dist/client/components/not-found-error"]}],d=["C:\\Users\\Mohd Uwaish\\Desktop\\MS\\DFG\\project\\DFG\\DFG_2025_Latest_work\\proxy-nov\\dfg-project-proxy-server\\app\\proxy\\[id]\\page.tsx"],p="/proxy/[id]/page",m={require:r,loadChunk:()=>Promise.resolve()},u=new a.AppPageRouteModule({definition:{kind:s.x.APP_PAGE,page:"/proxy/[id]/page",pathname:"/proxy/[id]",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},8196:(e,t,r)=>{Promise.resolve().then(r.bind(r,3369))},3369:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>P});var a=r(5344),s=r(3729),i=r(2254),l=r(7916),n=r(3644),o=r(1351),c=r(9436),d=r(6461),p=r(5545),m=r(6262),u=r(9895),x=r(6389),g=r(5299),h=r(5269);function f({proxyId:e,participantNumber:t,currentWaiting:r,maxParticipants:i,status:f,isGroupComplete:y,redirectUrl:j,groupName:b,category:N,treatmentTitle:w,participantTimerStart:v,participantGender:D}){let[S,E]=(0,s.useState)(3),[_,T]=(0,s.useState)(!1),[P,M]=(0,s.useState)(600),[k,A]=(0,s.useState)(!1);return console.log("WaitingRoom props:",{proxyId:e,participantNumber:t,currentWaiting:r,maxParticipants:i,status:f,isGroupComplete:y,redirectUrl:j,participantTimerStart:v,participantTimeLeft:P,participantTimerExpired:k}),(0,s.useEffect)(()=>{let e=null;if(v&&!y&&"expired"!==f){console.log("Starting participant timer - participantTimerStart:",v);let t=Math.max(0,600-Math.floor((Date.now()-v)/1e3));M(t),t>0?e=setInterval(()=>{let t=Math.floor((Date.now()-v)/1e3),r=Math.max(0,600-t);console.log("Participant timer update - elapsed:",t,"timeLeft:",r),M(r),r<=0&&(A(!0),e&&clearInterval(e))},1e3):A(!0)}return()=>{e&&clearInterval(e)}},[v,y,f]),(0,s.useEffect)(()=>{if(y&&"redirected"===f){T(!0);let e=setInterval(()=>{E(t=>t<=1?(clearInterval(e),j&&(window.location.href=j),0):t-1)},1e3);return()=>clearInterval(e)}},[y,f,j]),a.jsx("div",{className:"min-h-screen bg-gradient-to-br from-primary-50 via-background to-accent-50 flex items-center justify-center p-4",children:a.jsx(l.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"w-full max-w-2xl",children:(0,a.jsxs)(o.Zb,{className:"shadow-2xl border-0 bg-white/95 backdrop-blur-sm relative",children:[v&&!y&&!(k||"expired"===f)&&a.jsx(l.E.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},className:"absolute top-4 right-4 z-10",children:(0,a.jsxs)("div",{className:`
                px-3 py-2 rounded-lg shadow-md border font-mono text-sm font-bold
                ${P<=60?"bg-red-100 border-red-300 text-red-700":P<=180?"bg-amber-100 border-amber-300 text-amber-700":"bg-blue-100 border-blue-300 text-blue-700"}
              `,children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[a.jsx(p.Z,{className:`h-4 w-4 ${P<=60?"animate-pulse":""}`}),a.jsx("span",{children:`${Math.floor(P/60)}:${(P%60).toString().padStart(2,"0")}`})]}),a.jsx("div",{className:"text-xs font-normal mt-1 opacity-75 text-center",children:"Your time left"})]})}),(0,a.jsxs)(o.Ol,{className:"text-center pb-6",children:[a.jsx(l.E.div,{initial:{scale:0},animate:{scale:1},transition:{delay:.2,type:"spring"},className:`mx-auto mb-4 flex h-16 w-16 items-center justify-center rounded-full ${k||"expired"===f?"bg-gradient-to-r from-red-600 to-red-700":y?"bg-gradient-to-r from-green-600 to-green-700":"bg-gradient-to-r from-primary-600 to-accent-600"}`,children:k||"expired"===f?a.jsx(p.Z,{className:"h-8 w-8 text-white"}):y?a.jsx(m.Z,{className:"h-8 w-8 text-white"}):a.jsx(u.Z,{className:"h-8 w-8 text-white"})}),a.jsx(o.ll,{className:"text-2xl font-bold text-gray-900",children:k||"expired"===f?"Time Expired":y?"Group Complete!":"Experiment Waiting Room"}),a.jsx(o.SZ,{className:"text-gray-600 text-lg",children:(()=>{if(k||"expired"===f)return"Your waiting time has expired. You did not get matched with a group in time.";if(y)return"Your group is complete! Redirecting to experiment...";let e=3-(r%3||3);return"All Male"===N?1===e?"Waiting for 1 more male participant to form a group...":`Waiting for ${e} more male participants to form a group...`:"All Female"===N?1===e?"Waiting for 1 more female participant to form a group...":`Waiting for ${e} more female participants to form a group...`:"Mixed"===N?"Waiting for participants to form a mixed-gender group...":1===e?"Waiting for 1 more participant to form a group...":`Waiting for ${e} more participants to form a group...`})()})]}),(0,a.jsxs)(o.aY,{className:"space-y-6",children:[a.jsx("div",{className:"flex items-center justify-center space-x-4",children:(0,a.jsxs)(c.C,{variant:"outline",className:"px-4 py-2 text-lg",children:["You are Participant #",t]})}),!(k||"expired"===f)&&(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[a.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Waiting for Group Formation"}),(0,a.jsxs)("span",{className:"text-sm font-bold text-gray-900",children:[r%3||3," / 3 in current group"]})]}),a.jsx(d.E,{value:(r%3||3)/3*100,className:"h-3"}),(0,a.jsxs)("div",{className:"flex justify-between text-xs text-gray-500",children:[a.jsx("span",{children:"Groups form automatically when 3 participants are ready"}),(0,a.jsxs)("span",{children:[r," total waiting"]})]})]}),a.jsx("div",{className:"flex justify-center space-x-4",children:Array.from({length:3},(e,t)=>{let s=t<(r%3||3);return a.jsx(l.E.div,{initial:{scale:0},animate:{scale:1},transition:{delay:.1*t},className:`
                      w-16 h-16 rounded-full border-2 flex items-center justify-center
                      ${s?"bg-green-100 border-green-500 text-green-700":"bg-gray-100 border-gray-300 text-gray-400"}
                    `,children:s?a.jsx(m.Z,{className:"h-6 w-6"}):a.jsx(u.Z,{className:"h-6 w-6"})},t)})}),a.jsx(n.M,{mode:"wait",children:k||"expired"===f?a.jsx(l.E.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"text-center space-y-4",children:(0,a.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-center space-x-2 text-red-700 mb-2",children:[a.jsx(p.Z,{className:"h-5 w-5"}),a.jsx("span",{className:"font-semibold",children:"Your Time Expired"})]}),a.jsx("p",{className:"text-red-600 text-sm mb-3",children:"Your 10-minute waiting period has ended. You were not matched with a group in time."}),a.jsx("div",{className:"mt-4 text-xs text-red-500",children:"You may close this page or contact the experiment administrator."})]})},"expired"):y?a.jsx(l.E.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"text-center space-y-4",children:(0,a.jsxs)("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-center space-x-2 text-green-700 mb-2",children:[a.jsx(m.Z,{className:"h-5 w-5"}),a.jsx("span",{className:"font-semibold",children:"Your group is complete!"})]}),_&&(0,a.jsxs)("div",{className:"flex items-center justify-center space-x-2 text-green-600",children:[a.jsx(g.Z,{className:"h-4 w-4"}),(0,a.jsxs)("span",{children:["Redirecting in ",S," seconds..."]})]})]})},"complete"):a.jsx(l.E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"text-center space-y-3",children:(0,a.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-center space-x-2 text-blue-700 mb-2",children:[a.jsx(x.Z,{className:"h-5 w-5 animate-spin"}),a.jsx("span",{className:"text-sm font-semibold",children:"Waiting for more participants..."})]}),a.jsx("p",{className:"text-xs text-blue-600",children:"Your group will form automatically when ready"})]})},"waiting")}),N&&"No Gender"!==N&&!(k||"expired"===f)&&a.jsx("div",{className:"bg-gradient-to-r from-purple-50 to-blue-50 border border-purple-200 rounded-lg p-4",children:(0,a.jsxs)("div",{className:"flex items-start gap-3",children:[a.jsx("div",{className:"p-2 rounded-lg bg-purple-100",children:a.jsx(u.Z,{className:"h-5 w-5 text-purple-600"})}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("h4",{className:"font-semibold text-purple-900 mb-1",children:["All Male"===N&&"All Male Room","All Female"===N&&"All Female Room","Mixed"===N&&"Mixed Gender Room"]}),(0,a.jsxs)("p",{className:"text-sm text-purple-800",children:["Groups of 3 ","All Male"===N?"male":"All Female"===N?"female":""," participants form automatically"]}),D&&(0,a.jsxs)("div",{className:"mt-2 inline-flex items-center gap-2 px-2 py-1 bg-white rounded-md border border-purple-200",children:[a.jsx("span",{className:"text-xs text-purple-700",children:"Your gender:"}),a.jsx("span",{className:"text-xs font-semibold text-purple-900",children:D})]})]})]})}),!(k||"expired"===f)&&(0,a.jsxs)("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4",children:[(0,a.jsxs)("h4",{className:"font-semibold text-gray-900 mb-3 flex items-center gap-2",children:[a.jsx("div",{className:"p-1 rounded bg-gray-200",children:a.jsx(h.Z,{className:"h-4 w-4 text-gray-700"})}),"Important Instructions"]}),(0,a.jsxs)("ul",{className:"text-sm text-gray-700 space-y-2",children:[(0,a.jsxs)("li",{className:"flex items-start gap-2",children:[a.jsx("span",{className:"text-primary-600 font-bold",children:"•"}),(0,a.jsxs)("span",{children:[a.jsx("strong",{children:"Keep this page open"})," - Do not close or refresh"]})]}),(0,a.jsxs)("li",{className:"flex items-start gap-2",children:[a.jsx("span",{className:"text-primary-600 font-bold",children:"•"}),(0,a.jsxs)("span",{children:[a.jsx("strong",{children:"You have 10 minutes"})," to be matched with a group"]})]}),(0,a.jsxs)("li",{className:"flex items-start gap-2",children:[a.jsx("span",{className:"text-primary-600 font-bold",children:"•"}),(0,a.jsxs)("span",{children:[a.jsx("strong",{children:"Groups of 3"})," form automatically as participants join"]})]}),(0,a.jsxs)("li",{className:"flex items-start gap-2",children:[a.jsx("span",{className:"text-primary-600 font-bold",children:"•"}),(0,a.jsxs)("span",{children:["You'll be ",a.jsx("strong",{children:"redirected automatically"})," when your group is ready"]})]})]})]})]})]})})})}var y=r(6212),j=r(5062),b=r(5719),N=r(5366),w=r(7970);let v=(0,r(7075).Z)("house",[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-6a2 2 0 0 1 2.582 0l7 6A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"r6nss1"}]]);var D=r(783),S=r.n(D);function E({error:e,errorType:t,link:r,usage:s,participantNumber:i,joinedAt:l}){let n=(()=>{switch(t){case"not_found":return{title:"Link Not Found",description:"The requested experiment link does not exist or has been deactivated.",icon:b.Z,variant:"destructive"};case"full":return{title:"Experiment Full",description:`This experiment group is already full. All ${r?.max_uses||0} participants have joined.`,icon:u.Z,variant:"default"};case"already_participated":return{title:"Already Participated",description:"You have already joined this experiment group.",icon:m.Z,variant:"default"};case"already_joined":return{title:"Already in Waiting Room",description:"You have already joined this waiting room. Please use your original tab/window.",icon:N.Z,variant:"default"};case"inactive":return{title:"Experiment Inactive",description:"This experiment is currently inactive. Please contact the administrator.",icon:w.Z,variant:"secondary"};default:return{title:"Error",description:e,icon:b.Z,variant:"destructive"}}})(),d=n.icon;return a.jsx("div",{className:"min-h-screen bg-gradient-to-br from-error-50 via-background to-warning-50 flex items-center justify-center p-4",children:a.jsx("div",{className:"w-full max-w-lg",children:(0,a.jsxs)(o.Zb,{className:"border-0 shadow-2xl bg-white/95 backdrop-blur-sm",children:[(0,a.jsxs)(o.Ol,{className:"text-center space-y-4 pb-8",children:[a.jsx("div",{className:"mx-auto flex h-16 w-16 items-center justify-center rounded-full bg-gradient-to-r from-error-100 to-error-200",children:a.jsx(d,{className:"h-8 w-8 text-error-600"})}),r&&(0,a.jsxs)(c.C,{variant:"outline",className:"mx-auto px-4 py-2 border-primary-200 bg-primary-50 text-primary-700",children:[a.jsx(u.Z,{className:"mr-2 h-4 w-4"}),r.group_name||"Experiment Group"]}),a.jsx(o.ll,{className:"text-2xl font-bold text-gray-900",children:n.title}),a.jsx(o.SZ,{className:"text-base text-gray-600",children:n.description})]}),(0,a.jsxs)(o.aY,{className:"space-y-6",children:[s&&"already_participated"===t&&(0,a.jsxs)(j.bZ,{className:"border-primary-200 bg-primary-50",children:[a.jsx(N.Z,{className:"h-4 w-4 text-primary-600"}),(0,a.jsxs)(j.X,{className:"text-primary-800",children:[(0,a.jsxs)("div",{className:"font-semibold mb-1",children:["Participant #",s.participant_number]}),(0,a.jsxs)("div",{className:"text-sm text-primary-700/70",children:["Joined on: ",new Date(s.used_at).toLocaleString()]})]})]}),"already_joined"===t&&i&&(0,a.jsxs)(j.bZ,{className:"border-amber-200 bg-amber-50",children:[a.jsx(b.Z,{className:"h-4 w-4 text-amber-600"}),(0,a.jsxs)(j.X,{className:"text-amber-800",children:[(0,a.jsxs)("div",{className:"font-semibold mb-2",children:["You are Participant #",i]}),(0,a.jsxs)("div",{className:"text-sm text-amber-700 space-y-2",children:[l&&(0,a.jsxs)("p",{children:["Joined at: ",new Date(l).toLocaleString()]}),a.jsx("p",{className:"font-medium",children:"⚠️ Please return to your original tab/window to see your waiting room status."}),a.jsx("p",{children:"Opening multiple tabs can cause issues with your participation."})]})]})]}),"full"===t&&r&&(0,a.jsxs)(j.bZ,{className:"border-warning-200 bg-warning-50",children:[a.jsx(b.Z,{className:"h-4 w-4 text-warning-600"}),a.jsx(j.X,{className:"text-warning-800",children:"Please contact the administrator if you need access to this experiment."})]}),a.jsx(y.z,{asChild:!0,className:"w-full bg-gradient-to-r from-primary-600 to-primary-700 hover:from-primary-700 hover:to-primary-800",size:"lg",children:(0,a.jsxs)(S(),{href:"/",children:[a.jsx(v,{className:"mr-2 h-4 w-4"}),"Return Home"]})})]})]})})})}var _=r(4572);function T({groupName:e,category:t,prolificPid:r,onSubmit:i}){let[n,d]=(0,s.useState)(""),[p,m]=(0,s.useState)(!1),x="All Male"===t?"male":"All Female"===t?"female":null;return a.jsx("div",{className:"min-h-screen bg-gradient-to-br from-primary-50 via-background to-accent-50 flex items-center justify-center p-4",children:a.jsx(l.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"w-full max-w-md",children:(0,a.jsxs)(o.Zb,{className:"shadow-2xl border-0 bg-white/95 backdrop-blur-sm",children:[(0,a.jsxs)(o.Ol,{className:"text-center pb-6",children:[a.jsx(l.E.div,{initial:{scale:0},animate:{scale:1},transition:{delay:.2,type:"spring"},className:"mx-auto mb-4 flex h-16 w-16 items-center justify-center rounded-full bg-gradient-to-r from-primary-600 to-accent-600",children:a.jsx(u.Z,{className:"h-8 w-8 text-white"})}),e&&a.jsx(c.C,{variant:"outline",className:"mx-auto mb-4 px-4 py-2 border-primary-200 bg-primary-50 text-primary-700",children:e}),a.jsx(o.ll,{className:"text-2xl font-bold text-gray-900",children:"Welcome to the Experiment"}),a.jsx(o.SZ,{className:"text-gray-600 text-base",children:"Please provide your gender information to continue"})]}),(0,a.jsxs)(o.aY,{className:"space-y-6",children:[r&&a.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:(0,a.jsxs)("p",{className:"text-sm text-blue-800",children:[a.jsx("strong",{children:"Prolific ID:"})," ",r]})}),t&&"No Gender"!==t&&a.jsx("div",{className:"bg-purple-50 border border-purple-200 rounded-lg p-4",children:(0,a.jsxs)("div",{className:"flex items-start gap-2",children:[a.jsx(h.Z,{className:"h-5 w-5 text-purple-600 mt-0.5 flex-shrink-0"}),(0,a.jsxs)("div",{children:[a.jsx("h4",{className:"font-semibold text-purple-900 mb-1",children:"Group Requirement"}),(0,a.jsxs)("p",{className:"text-sm text-purple-800",children:["All Male"===t&&"This experiment requires male participants only.","All Female"===t&&"This experiment requires female participants only.","Mixed"===t&&"This experiment requires a mixed-gender group."]})]})]})}),(0,a.jsxs)("form",{onSubmit:e=>{e.preventDefault(),n&&(m(!0),i(n))},className:"space-y-4",children:[(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)(_._,{className:"text-base font-semibold text-gray-900",children:["What is your gender? ",a.jsx("span",{className:"text-red-500",children:"*"})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[a.jsx(l.E.button,{type:"button",whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>d("MALE"),disabled:"female"===x,className:`
                      w-full p-4 rounded-lg border-2 text-left transition-all
                      ${"MALE"===n?"border-primary-500 bg-primary-50 shadow-md":"border-gray-200 bg-white hover:border-gray-300"}
                      ${"female"===x?"opacity-50 cursor-not-allowed":"cursor-pointer"}
                    `,children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[a.jsx("span",{className:"font-medium text-gray-900",children:"Male"}),"MALE"===n&&a.jsx("div",{className:"h-5 w-5 rounded-full bg-primary-500 flex items-center justify-center",children:a.jsx("div",{className:"h-2 w-2 rounded-full bg-white"})})]})}),a.jsx(l.E.button,{type:"button",whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>d("FEMALE"),disabled:"male"===x,className:`
                      w-full p-4 rounded-lg border-2 text-left transition-all
                      ${"FEMALE"===n?"border-primary-500 bg-primary-50 shadow-md":"border-gray-200 bg-white hover:border-gray-300"}
                      ${"male"===x?"opacity-50 cursor-not-allowed":"cursor-pointer"}
                    `,children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[a.jsx("span",{className:"font-medium text-gray-900",children:"Female"}),"FEMALE"===n&&a.jsx("div",{className:"h-5 w-5 rounded-full bg-primary-500 flex items-center justify-center",children:a.jsx("div",{className:"h-2 w-2 rounded-full bg-white"})})]})}),(!x||"Mixed"===t)&&a.jsx(l.E.button,{type:"button",whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>d("OTHER"),className:`
                        w-full p-4 rounded-lg border-2 text-left transition-all cursor-pointer
                        ${"OTHER"===n?"border-primary-500 bg-primary-50 shadow-md":"border-gray-200 bg-white hover:border-gray-300"}
                      `,children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[a.jsx("span",{className:"font-medium text-gray-900",children:"Other / Prefer not to say"}),"OTHER"===n&&a.jsx("div",{className:"h-5 w-5 rounded-full bg-primary-500 flex items-center justify-center",children:a.jsx("div",{className:"h-2 w-2 rounded-full bg-white"})})]})})]})]}),a.jsx(y.z,{type:"submit",disabled:!n||p,className:"w-full bg-gradient-to-r from-primary-600 to-accent-600 hover:from-primary-700 hover:to-accent-700 disabled:opacity-50 disabled:cursor-not-allowed",size:"lg",children:p?(0,a.jsxs)(a.Fragment,{children:[a.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Joining..."]}):(0,a.jsxs)(a.Fragment,{children:["Continue to Waiting Room",a.jsx(g.Z,{className:"ml-2 h-4 w-4"})]})})]}),a.jsx("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-3",children:(0,a.jsxs)("p",{className:"text-xs text-gray-600",children:[a.jsx("strong",{children:"Privacy:"})," Your gender information is used only for group formation and is linked to your Prolific ID for this experiment. This data is not shared with third parties."]})})]})]})})})}function P(){let e=(0,i.useParams)(),t=e?.id,[r,n]=(0,s.useState)(null),[o,c]=(0,s.useState)(!0),[d,p]=(0,s.useState)(""),[m,u]=(0,s.useState)(null),[x,g]=(0,s.useState)(null),[h,y]=(0,s.useState)(!1),[j,b]=(0,s.useState)(null);(0,s.useEffect)(()=>{if(t){let e=new URLSearchParams(window.location.search),t=e.get("gender")||e.get("GENDER"),r=e.get("PROLIFIC_PID")||e.get("prolific_pid");console.log("\uD83D\uDD0D URL Parameters:",{gender:t,prolific_pid:r}),g(r);let a=function(){let e=document.createElement("canvas"),t=e.getContext("2d");t.textBaseline="top",t.font="14px Arial",t.fillText("Browser fingerprint",2,2);let r=[navigator.userAgent,navigator.language,screen.width+"x"+screen.height,new Date().getTimezoneOffset(),e.toDataURL()].join("|"),a=0;for(let e=0;e<r.length;e++)a=(a<<5)-a+r.charCodeAt(e),a&=a;return Math.abs(a).toString(16)}();p(a),t?(u(t),w(a,t,r)):N(a,r)}},[t]);let N=async(e,r)=>{try{let a=await fetch(`/api/proxy/${t}/join`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({fingerprint:e,gender:null,prolific_pid:r})}),s=await a.json();if(a.ok||"gender"!==s.missingParameter){if(a.ok)n(s),c(!1);else{let e="inactive";404===a.status?e="not_found":403===a.status&&("already_joined"===s.errorType?e="already_joined":s.error?.includes("full")&&(e="full")),n({error:s.error,errorType:e,participantNumber:s.participantNumber,joinedAt:s.joinedAt}),c(!1)}}else b({groupName:s.groupName,category:s.category}),y(!0),c(!1)}catch(e){console.error("Error fetching link info:",e),n({error:"Network error. Please try again.",errorType:"inactive"}),c(!1)}},w=async(e,r,a)=>{try{let s=await fetch(`/api/proxy/${t}/join`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({fingerprint:e,gender:r,prolific_pid:a})}),i=await s.json();if(console.log("Join response:",{status:s.status,result:i}),s.ok)n(i),("redirected"===i.status||i.isGroupComplete)&&i.redirectUrl&&(console.log("\uD83D\uDE80 GROUP FORMED! Redirecting immediately..."),console.log("Status:",i.status),console.log("Redirect URL:",i.redirectUrl),setTimeout(()=>{window.location.href=i.redirectUrl},1500));else{let e="inactive";404===s.status?e="not_found":400===s.status?e="inactive":403===s.status&&(e="already_joined"===i.errorType?"already_joined":i.error?.includes("full")||"full"===i.errorType?"full":"inactive"),console.error("❌ Join failed:",i.error),n({error:i.error||"Unable to join experiment",errorType:e,participantNumber:i.participantNumber,joinedAt:i.joinedAt})}}catch(e){console.error("Error joining waiting room:",e),n({error:"Network error. Please try again.",errorType:"inactive"})}finally{c(!1)}},v=async()=>{if(d||x)try{let e=new URLSearchParams;x&&e.append("prolific_pid",x),d&&e.append("fingerprint",d);let a=await fetch(`/api/proxy/${t}/status?${e.toString()}`),s=await a.json();if(console.log("========== STATUS CHECK =========="),console.log("Prolific PID:",x),console.log("Full result:",JSON.stringify(s,null,2)),console.log("result.status:",s.status),console.log("result.userStatus:",s.userStatus),console.log("result.userStatus?.status:",s.userStatus?.status),console.log("result.real_url:",s.real_url),console.log("=================================="),a.ok){let e=s.userStatus?.status==="redirected",t={...r,currentWaiting:s.current_waiting,maxParticipants:s.max_uses,isGroupComplete:e,redirectUrl:s.real_url,groupName:s.group_name,category:s.category,treatmentTitle:s.treatment_title,participantTimerStart:s.participantTimerStart,participantTimerExpired:s.participantTimerExpired,participantTimeLeft:s.participantTimeLeft,status:s.participantTimerExpired?"expired":s.status||r?.status||"waiting"};s.userStatus&&(t.status=s.userStatus.status,t.participantNumber=s.userStatus.participantNumber,t.groupSessionId=s.userStatus.groupSessionId,t.participantTimerStart=s.userStatus.participantTimerStart,t.participantTimeLeft=s.userStatus.participantTimeLeft,t.participantTimerExpired=s.userStatus.participantTimerExpired),console.log("\uD83D\uDCA1 isGroupComplete set to:",t.isGroupComplete,"(based on userStatus.status:",s.userStatus?.status,")"),n(t);let a=s.userStatus?.status==="redirected"||"redirected"===t.status||"redirected"===s.status;console.log("\uD83D\uDD0D Redirect check:"),console.log("  - result.userStatus?.status:",s.userStatus?.status),console.log("  - newData.status:",t.status),console.log("  - result.status:",s.status),console.log("  - isRedirected:",a),console.log("  - result.real_url:",s.real_url),a&&s.real_url?(console.log("\uD83D\uDE80\uD83D\uDE80\uD83D\uDE80 REDIRECTING NOW! \uD83D\uDE80\uD83D\uDE80\uD83D\uDE80"),console.log("Redirect URL:",s.real_url),console.log("User Status:",s.userStatus),window.location.href=s.real_url):console.log("❌ NOT redirecting - isRedirected:",a,"real_url:",s.real_url)}}catch(e){console.error("Error checking status:",e)}};return((0,s.useEffect)(()=>{if(r&&"redirected"!==r.status&&!r.isGroupComplete){console.log("\uD83D\uDCE1 Starting polling... Current status:",r.status,"Prolific PID:",x);let e=setInterval(()=>{console.log("⏰ Polling tick - checking status for:",x),v()},2e3);return()=>{console.log("\uD83D\uDED1 Stopping poll for:",x),clearInterval(e)}}r?.status==="redirected"&&console.log("✅ Status is redirected - stopping poll for:",x)},[r?.status,r?.isGroupComplete,d,x]),o)?a.jsx("div",{className:"min-h-screen bg-gradient-to-br from-primary-50 via-background to-accent-50 flex items-center justify-center",children:(0,a.jsxs)(l.E.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"text-center",children:[a.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600 mx-auto mb-4"}),a.jsx("p",{className:"text-gray-600",children:"Loading experiment..."})]})}):h?a.jsx(T,{groupName:j?.groupName,category:j?.category,prolificPid:x||void 0,onSubmit:e=>{u(e),y(!1),c(!0),w(d,e,x)}}):r?.error?a.jsx(E,{error:r.error,errorType:r.errorType||"inactive",participantNumber:r.participantNumber,joinedAt:r.joinedAt}):a.jsx(f,{proxyId:t,participantNumber:r?.participantNumber||0,currentWaiting:r?.currentWaiting||0,maxParticipants:r?.maxParticipants||3,status:r?.status||"waiting",isGroupComplete:r?.isGroupComplete||!1,redirectUrl:r?.redirectUrl,groupName:r?.groupName,category:r?.category,treatmentTitle:r?.treatmentTitle,participantTimerStart:r?.participantTimerStart,participantGender:m||void 0})}},2254:(e,t,r)=>{e.exports=r(4767)},9499:(e,t,r)=>{"use strict";r.r(t),r.d(t,{$$typeof:()=>i,__esModule:()=>s,default:()=>l});let a=(0,r(6843).createProxy)(String.raw`C:\Users\Mohd Uwaish\Desktop\MS\DFG\project\DFG\DFG_2025_Latest_work\proxy-nov\dfg-project-proxy-server\app\proxy\[id]\page.tsx`),{__esModule:s,$$typeof:i}=a,l=a.default}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[580,362,976,904],()=>r(5249));module.exports=a})();