(()=>{var e={};e.id=330,e.ids=[330],e.modules={7849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},5403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},4749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},5528:e=>{"use strict";e.exports=require("next/dist\\client\\components\\action-async-storage.external.js")},1877:e=>{"use strict";e.exports=require("next/dist\\client\\components\\request-async-storage.external.js")},5319:e=>{"use strict";e.exports=require("next/dist\\client\\components\\static-generation-async-storage.external.js")},4334:(e,t,r)=>{"use strict";r.r(t),r.d(t,{GlobalError:()=>n.a,__next_app__:()=>x,originalPathname:()=>p,pages:()=>d,routeModule:()=>m,tree:()=>o});var a=r(482),s=r(9108),i=r(2563),n=r.n(i),l=r(8300),c={};for(let e in l)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(c[e]=()=>l[e]);r.d(t,c);let o=["",{children:["proxy",{children:["[id]",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,9499)),"C:\\Users\\Mohd Uwaish\\Desktop\\MS\\DFG\\project\\proxy-working\\app\\proxy\\[id]\\page.tsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(r.bind(r,7948)),"C:\\Users\\Mohd Uwaish\\Desktop\\MS\\DFG\\project\\proxy-working\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,9361,23)),"next/dist/client/components/not-found-error"]}],d=["C:\\Users\\Mohd Uwaish\\Desktop\\MS\\DFG\\project\\proxy-working\\app\\proxy\\[id]\\page.tsx"],p="/proxy/[id]/page",x={require:r,loadChunk:()=>Promise.resolve()},m=new a.AppPageRouteModule({definition:{kind:s.x.APP_PAGE,page:"/proxy/[id]/page",pathname:"/proxy/[id]",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:o}})},4779:(e,t,r)=>{Promise.resolve().then(r.bind(r,9965))},9965:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>S});var a=r(5344),s=r(3729),i=r(2254),n=r(7916),l=r(3644),c=r(1351),o=r(9436),d=r(6461),p=r(6262),x=r(9895),m=r(6389),u=r(7075);let h=(0,u.Z)("clock",[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);var g=r(5299);function y({proxyId:e,participantNumber:t,currentWaiting:r,maxParticipants:i,status:u,isGroupComplete:y,redirectUrl:j,groupName:f,category:b,treatmentTitle:N}){let[v,w]=(0,s.useState)(3),[_,k]=(0,s.useState)(!1),P=r/i*100;return console.log("WaitingRoom props:",{proxyId:e,participantNumber:t,currentWaiting:r,maxParticipants:i,status:u,isGroupComplete:y,redirectUrl:j}),(0,s.useEffect)(()=>{if(y&&"redirected"===u){k(!0);let e=setInterval(()=>{w(t=>t<=1?(clearInterval(e),j&&(window.location.href=j),0):t-1)},1e3);return()=>clearInterval(e)}},[y,u,j]),a.jsx("div",{className:"min-h-screen bg-gradient-to-br from-primary-50 via-background to-accent-50 flex items-center justify-center p-4",children:a.jsx(n.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"w-full max-w-2xl",children:(0,a.jsxs)(c.Zb,{className:"shadow-2xl border-0 bg-white/95 backdrop-blur-sm",children:[(0,a.jsxs)(c.Ol,{className:"text-center pb-6",children:[a.jsx(n.E.div,{initial:{scale:0},animate:{scale:1},transition:{delay:.2,type:"spring"},className:"mx-auto mb-4 flex h-16 w-16 items-center justify-center rounded-full bg-gradient-to-r from-primary-600 to-accent-600",children:y?a.jsx(p.Z,{className:"h-8 w-8 text-white"}):a.jsx(x.Z,{className:"h-8 w-8 text-white"})}),a.jsx(c.ll,{className:"text-2xl font-bold text-gray-900",children:y?"Group Complete!":"Experiment Waiting Room"}),a.jsx(c.SZ,{className:"text-gray-600 text-lg",children:(()=>{if(y)return"All participants ready! Redirecting to experiment...";let e=i-r;return 1===e?"Waiting for 1 more participant to join...":`Waiting for ${e} more participants to join...`})()})]}),(0,a.jsxs)(c.aY,{className:"space-y-6",children:[a.jsx("div",{className:"flex items-center justify-center space-x-4",children:(0,a.jsxs)(o.C,{variant:"outline",className:"px-4 py-2 text-lg",children:["You are Participant #",t]})}),(f||b||N)&&(0,a.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[a.jsx("h4",{className:"font-semibold text-blue-900 mb-3",children:"Experiment Information:"}),(0,a.jsxs)("div",{className:"grid gap-2 text-sm",children:[f&&(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[a.jsx("span",{className:"text-blue-700 font-medium",children:"Group:"}),a.jsx("span",{className:"text-blue-800",children:f})]}),b&&(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[a.jsx("span",{className:"text-blue-700 font-medium",children:"Category:"}),a.jsx(o.C,{variant:"secondary",className:"text-xs",children:b})]}),N&&(0,a.jsxs)("div",{className:"flex flex-col gap-1",children:[a.jsx("span",{className:"text-blue-700 font-medium",children:"Treatment:"}),a.jsx("span",{className:"text-blue-800 text-xs leading-relaxed",children:N})]})]})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[a.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Participants Joined"}),(0,a.jsxs)("span",{className:"text-sm font-bold text-gray-900",children:[r," / ",i]})]}),a.jsx(d.E,{value:P,className:"h-3"}),(0,a.jsxs)("div",{className:"flex justify-between text-xs text-gray-500",children:[a.jsx("span",{children:"Waiting for participants..."}),(0,a.jsxs)("span",{children:[Math.round(P),"% complete"]})]})]}),a.jsx("div",{className:"flex justify-center space-x-4",children:Array.from({length:i},(e,t)=>a.jsx(n.E.div,{initial:{scale:0},animate:{scale:1},transition:{delay:.1*t},className:`
                    w-16 h-16 rounded-full border-2 flex items-center justify-center
                    ${t<r?"bg-green-100 border-green-500 text-green-700":"bg-gray-100 border-gray-300 text-gray-400"}
                  `,children:t<r?a.jsx(p.Z,{className:"h-6 w-6"}):a.jsx(x.Z,{className:"h-6 w-6"})},t))}),a.jsx(l.M,{mode:"wait",children:y?a.jsx(n.E.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"text-center space-y-4",children:(0,a.jsxs)("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-center space-x-2 text-green-700 mb-2",children:[a.jsx(p.Z,{className:"h-5 w-5"}),a.jsx("span",{className:"font-semibold",children:"All participants have joined!"})]}),_&&(0,a.jsxs)("div",{className:"flex items-center justify-center space-x-2 text-green-600",children:[a.jsx(g.Z,{className:"h-4 w-4"}),(0,a.jsxs)("span",{children:["Redirecting in ",v," seconds..."]})]})]})},"complete"):(0,a.jsxs)(n.E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"text-center space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-center space-x-2 text-primary-600",children:[a.jsx(m.Z,{className:"h-5 w-5 animate-spin"}),a.jsx("span",{className:"text-sm font-medium",children:"Please wait while other participants join..."})]}),(0,a.jsxs)("div",{className:"flex items-center justify-center space-x-2 text-gray-500 text-sm",children:[a.jsx(h,{className:"h-4 w-4"}),a.jsx("span",{children:"This page will automatically update"})]})]},"waiting")}),(0,a.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[a.jsx("h4",{className:"font-semibold text-blue-900 mb-2",children:"Instructions:"}),(0,a.jsxs)("ul",{className:"text-sm text-blue-800 space-y-1",children:[a.jsx("li",{children:"• Please keep this page open and wait for other participants"}),a.jsx("li",{children:"• Do not refresh or close this page"}),a.jsx("li",{children:"• You will be automatically redirected when everyone has joined"}),(0,a.jsxs)("li",{children:["• The experiment will begin once all ",i," participants are ready"]})]})]})]})]})})})}var j=r(6212),f=r(5062),b=r(5719),N=r(7970),v=r(5366);let w=(0,u.Z)("house",[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-6a2 2 0 0 1 2.582 0l7 6A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"r6nss1"}]]);var _=r(783),k=r.n(_);function P({error:e,errorType:t,link:r,usage:s}){let i=(()=>{switch(t){case"not_found":return{title:"Link Not Found",description:"The requested experiment link does not exist or has been deactivated.",icon:b.Z,variant:"destructive"};case"full":return{title:"Experiment Full",description:`This experiment group is already full. All ${r?.max_uses||0} participants have joined.`,icon:x.Z,variant:"default"};case"already_participated":return{title:"Already Participated",description:"You have already joined this experiment group.",icon:p.Z,variant:"default"};case"inactive":return{title:"Experiment Inactive",description:"This experiment is currently inactive. Please contact the administrator.",icon:N.Z,variant:"secondary"};default:return{title:"Error",description:e,icon:b.Z,variant:"destructive"}}})(),n=i.icon;return a.jsx("div",{className:"min-h-screen bg-gradient-to-br from-error-50 via-background to-warning-50 flex items-center justify-center p-4",children:a.jsx("div",{className:"w-full max-w-lg",children:(0,a.jsxs)(c.Zb,{className:"border-0 shadow-2xl bg-white/95 backdrop-blur-sm",children:[(0,a.jsxs)(c.Ol,{className:"text-center space-y-4 pb-8",children:[a.jsx("div",{className:"mx-auto flex h-16 w-16 items-center justify-center rounded-full bg-gradient-to-r from-error-100 to-error-200",children:a.jsx(n,{className:"h-8 w-8 text-error-600"})}),r&&(0,a.jsxs)(o.C,{variant:"outline",className:"mx-auto px-4 py-2 border-primary-200 bg-primary-50 text-primary-700",children:[a.jsx(x.Z,{className:"mr-2 h-4 w-4"}),r.group_name||"Experiment Group"]}),a.jsx(c.ll,{className:"text-2xl font-bold text-gray-900",children:i.title}),a.jsx(c.SZ,{className:"text-base text-gray-600",children:i.description})]}),(0,a.jsxs)(c.aY,{className:"space-y-6",children:[s&&"already_participated"===t&&(0,a.jsxs)(f.bZ,{className:"border-primary-200 bg-primary-50",children:[a.jsx(v.Z,{className:"h-4 w-4 text-primary-600"}),(0,a.jsxs)(f.X,{className:"text-primary-800",children:[(0,a.jsxs)("div",{className:"font-semibold mb-1",children:["Participant #",s.participant_number]}),(0,a.jsxs)("div",{className:"text-sm text-primary-700/70",children:["Joined on: ",new Date(s.used_at).toLocaleString()]})]})]}),"full"===t&&r&&(0,a.jsxs)(f.bZ,{className:"border-warning-200 bg-warning-50",children:[a.jsx(b.Z,{className:"h-4 w-4 text-warning-600"}),a.jsx(f.X,{className:"text-warning-800",children:"Please contact the administrator if you need access to this experiment."})]}),a.jsx(j.z,{asChild:!0,className:"w-full bg-gradient-to-r from-primary-600 to-primary-700 hover:from-primary-700 hover:to-primary-800",size:"lg",children:(0,a.jsxs)(k(),{href:"/",children:[a.jsx(w,{className:"mr-2 h-4 w-4"}),"Return Home"]})})]})]})})})}function S(){let e=(0,i.useParams)(),t=e?.id,[r,l]=(0,s.useState)(null),[c,o]=(0,s.useState)(!0),[d,p]=(0,s.useState)("");(0,s.useEffect)(()=>{if(t){let e=function(){let e=document.createElement("canvas"),t=e.getContext("2d");t.textBaseline="top",t.font="14px Arial",t.fillText("Browser fingerprint",2,2);let r=[navigator.userAgent,navigator.language,screen.width+"x"+screen.height,new Date().getTimezoneOffset(),e.toDataURL()].join("|"),a=0;for(let e=0;e<r.length;e++)a=(a<<5)-a+r.charCodeAt(e),a&=a;return Math.abs(a).toString(16)}();p(e),x(e)}},[t]);let x=async e=>{try{let r=await fetch(`/api/proxy/${t}/join`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({fingerprint:e})}),a=await r.json();r.ok?(l(a),a.isGroupComplete&&a.redirectUrl&&setTimeout(()=>{window.location.href=a.redirectUrl},3e3)):l({error:a.error,errorType:404===r.status?"not_found":403===r.status?"full":"inactive"})}catch(e){console.error("Error joining waiting room:",e),l({error:"Network error. Please try again.",errorType:"inactive"})}finally{o(!1)}},m=async()=>{if(d)try{let e=await fetch(`/api/proxy/${t}/status?fingerprint=${d}`),a=await e.json();if(console.log("Status check result:",a),e.ok){let e={...r,currentWaiting:a.current_waiting,maxParticipants:a.max_uses,isGroupComplete:a.is_full||a.has_redirected_group,redirectUrl:a.real_url,groupName:a.group_name,category:a.category,treatmentTitle:a.treatment_title};a.userStatus&&(e.status=a.userStatus.status,e.participantNumber=a.userStatus.participantNumber,e.groupSessionId=a.userStatus.groupSessionId),l(e),a.userStatus&&"redirected"===a.userStatus.status&&a.real_url&&(console.log("Redirecting to:",a.real_url),setTimeout(()=>{window.location.href=a.real_url},3e3))}}catch(e){console.error("Error checking status:",e)}};return((0,s.useEffect)(()=>{if(r&&"redirected"!==r.status&&!r.isGroupComplete){let e=setInterval(m,2e3);return()=>clearInterval(e)}},[r?.status,r?.isGroupComplete,d]),c)?a.jsx("div",{className:"min-h-screen bg-gradient-to-br from-primary-50 via-background to-accent-50 flex items-center justify-center",children:(0,a.jsxs)(n.E.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"text-center",children:[a.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600 mx-auto mb-4"}),a.jsx("p",{className:"text-gray-600",children:"Loading experiment..."})]})}):r?.error?a.jsx(P,{error:r.error,errorType:r.errorType||"inactive"}):a.jsx(y,{proxyId:t,participantNumber:r?.participantNumber||0,currentWaiting:r?.currentWaiting||0,maxParticipants:r?.maxParticipants||3,status:r?.status||"waiting",isGroupComplete:r?.isGroupComplete||!1,redirectUrl:r?.redirectUrl,groupName:r?.groupName,category:r?.category,treatmentTitle:r?.treatmentTitle})}},2254:(e,t,r)=>{e.exports=r(4767)},9499:(e,t,r)=>{"use strict";r.r(t),r.d(t,{$$typeof:()=>i,__esModule:()=>s,default:()=>n});let a=(0,r(6843).createProxy)(String.raw`C:\Users\Mohd Uwaish\Desktop\MS\DFG\project\proxy-working\app\proxy\[id]\page.tsx`),{__esModule:s,$$typeof:i}=a,n=a.default}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[580,349,493,894],()=>r(4334));module.exports=a})();